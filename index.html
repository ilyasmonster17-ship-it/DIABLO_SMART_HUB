<!DOCTYPE html>
<html lang="ar" dir="rtl" id="diablo-app">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Diablo Hub | New Generation</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
<style>
:root{--p:#ff4500;--bg:#050505;--card:#111;--t:#fff;--border:#222;--gold:#ffd700;}
.light-mode{--bg:#f5f5f5;--card:#fff;--t:#222;--border:#ddd;}
body{background:var(--bg);color:var(--t);font-family:'Cairo',sans-serif;margin:0;padding-bottom:100px;overflow-x:hidden;}
#startScreen{display:flex;position:fixed;inset:0;background:var(--bg);z-index:9999;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:20px;}
#mainApp{display:none;}
header{padding:15px 5%;display:flex;justify-content:space-between;align-items:center;background:var(--card);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:1000;}
.search-bar{flex:1;display:flex;background:var(--bg);border:1px solid var(--border);border-radius:20px;padding:5px 15px;margin:0 10px;}
.search-bar input{border:none;background:none;color:var(--t);outline:none;width:100%;font-size:14px;}
.categories{display:flex;overflow-x:auto;gap:10px;padding:10px 5%;white-space:nowrap;}
.cat-btn{background:var(--card);border:1px solid var(--border);color:var(--t);padding:8px 15px;border-radius:20px;cursor:pointer;}
.cat-btn.active{background:var(--p);border-color:var(--p);color:white;}
.publish-btn-main{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);width:50px;height:40px;background:linear-gradient(90deg,#00f2ea 0%,#ff0050 100%);border-radius:12px;display:none;align-items:center;justify-content:center;z-index:9000;cursor:pointer;border:none;}
.publish-btn-main::after{content:'+';color:black;font-size:25px;font-weight:bold;background:white;width:25px;height:25px;border-radius:5px;display:flex;align-items:center;justify-content:center;}
.post-card{background:var(--card);border:1px solid var(--border);border-radius:15px;margin:15px 5%;padding:15px;position:relative;}
.post-card.premium{border:2px solid var(--gold);box-shadow:0 0 15px rgba(255,215,0,0.2);}
.price-tag{position:absolute;top:10px;left:10px;background:#25d366;color:white;padding:3px 12px;border-radius:20px;font-weight:bold;}
.side-menu{position:fixed;top:0;right:-100%;width:280px;height:100%;background:var(--card);z-index:9500;transition:0.4s;padding:20px;box-sizing:border-box;overflow-y:auto;}
.side-menu.active{right:0;}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:none;z-index:9400;}
.btn{background:var(--p);color:white;border:none;padding:12px;border-radius:8px;cursor:pointer;font-weight:bold;width:100%;margin-top:10px;text-align:center;text-decoration:none;display:block;}
input,textarea,select{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:1px solid var(--border);background:var(--bg);color:var(--t);box-sizing:border-box;}
#bot-chat-window{position:fixed;bottom:90px;left:20px;width:300px;height:400px;background:var(--card);border:1px solid var(--p);border-radius:15px;display:none;flex-direction:column;z-index:9999;}
.chat-area{flex:1;padding:10px;overflow-y:auto;display:flex;flex-direction:column;gap:8px;}
.msg{padding:8px 12px;border-radius:10px;max-width:80%;font-size:13px;}
.msg.bot{background:#222;align-self:flex-start;}
.msg.user{background:var(--p);align-self:flex-end;}
#premiumPage{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:10001;align-items:center;justify-content:center;padding:20px;}
#premiumPage .content{background:var(--card);padding:20px;border-radius:15px;max-width:500px;width:100%;}
#requestModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:10001;align-items:center;justify-content:center;padding:20px;}
#requestModal .content{background:var(--card);padding:20px;border-radius:15px;max-width:500px;width:100%;}
#requestsList{margin-top:15px;}
</style>
</head>
<body>
<div id="startScreen">
<h1 style="color:var(--p);margin-bottom:5px;">DIABLO HUB</h1>
<p style="font-size:14px;opacity:0.8;">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø£Ù‚ÙˆÙ‰ Ù…Ù†ØµØ© Ø¹Ù‚Ø§Ø±ÙŠØ©</p>
<div style="width:100%;max-width:300px;margin-top:20px;">
<button class="btn" onclick="setRole('investor')">Ø£Ù†Ø§ Ù…Ø³ØªØ«Ù…Ø± (ØªØµÙØ­ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª)</button>
<button class="btn" style="background:#222;border:1px solid var(--p);" onclick="setRole('seller')">Ø£Ù†Ø§ Ù…Ø§Ù„Ùƒ (Ø£Ø±ÙŠØ¯ Ø§Ù„Ù†Ø´Ø±)</button>
</div>
</div>

<div id="mainApp">
<header>
<button onclick="toggleMenu()" style="background:none;border:none;color:var(--p);font-size:24px;">â˜°</button>
<div class="search-bar"><input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†Ø²Ù„ØŒ Ø´Ù‚Ø©..." oninput="filterPosts()"></div>
<button onclick="toggleTheme()" style="background:none;border:none;color:var(--p);"><i class="fas fa-moon"></i></button>
</header>

<div class="categories">
<button class="cat-btn active" onclick="setCat('Ø§Ù„ÙƒÙ„')">Ø§Ù„ÙƒÙ„</button>
<button class="cat-btn" onclick="setCat('Ø´Ù‚Ù‚')">ğŸ™ï¸ Ø´Ù‚Ù‚</button>
<button class="cat-btn" onclick="setCat('ÙÙŠÙ„Ø§Øª')">ğŸ° ÙÙŠÙ„Ø§Øª</button>
<button class="cat-btn" onclick="setCat('Ù…Ù†Ø§Ø²Ù„')">ğŸ¡ Ù…Ù†Ø§Ø²Ù„</button>
<button class="cat-btn" style="background:var(--gold);color:black;" onclick="showPremiumPage()">âœ¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©</button>
</div>

<div id="cloudFeed"></div>
<button class="publish-btn-main" id="mainPublishBtn" onclick="openPublishModal(false)"></button>
</div>

<!-- Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯: Ø§Ù„Ù†Ø´Ø±ØŒ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŒ Ø§Ù„Ø¨ÙˆØªØŒ Ø§Ù„Ø¯ÙˆØ§Ù„ -->
<script>
// Firebase
const firebaseConfig={apiKey:"AIzaSyCGWNteBBsejx6UISfvnTY1YmnQeom7vNg",authDomain:"diiblosmart.firebaseapp.com",projectId:"diiblosmart",storageBucket:"diiblosmart.firebasestorage.app"};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
const auth=firebase.auth();

// Ø¨ÙŠØ§Ù†Ø§Øª
let currentUser=null,tempImgs=[],isPremiumPost=false,currentCat='Ø§Ù„ÙƒÙ„';
let requests=[],botMemory=[];
const MAX_BOT_MEMORY=50;

// Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
auth.onAuthStateChanged(u=>{if(u) currentUser=u;});

function setRole(role){
document.getElementById('startScreen').style.display='none';
document.getElementById('mainApp').style.display='block';
if(role==='seller') document.getElementById('mainPublishBtn').style.display='flex';
loadCloudData();
loadRequests();
}

function loadCloudData(){
db.collection("diablo_posts").orderBy("isPremium","desc").orderBy("time","desc").onSnapshot(snap=>{
const feed=document.getElementById('cloudFeed'); feed.innerHTML="";
snap.forEach(doc=>{
const p=doc.data();
if(currentCat!=='Ø§Ù„ÙƒÙ„'&&p.type!==currentCat) return;
let delBtn=(currentUser&&currentUser.uid===p.userId)?`<button class="btn" style="background:red;margin-top:5px;" onclick="deletePost('${doc.id}')">Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±</button>`:'';
feed.innerHTML+=`
<div class="post-card ${p.isPremium?'premium':''}" data-title="${p.title.toLowerCase()}">
${p.isPremium?'<span style="color:gold;font-size:10px;font-weight:bold;">âœ¨ Ø¥Ø¹Ù„Ø§Ù† Ù…Ù…ÙŠØ²</span>':''}
<span class="price-tag">${p.price}$</span>
<div style="display:flex;overflow-x:auto;gap:10px;">${p.imgs.map(i=>`<img src="${i}" style="height:150px;border-radius:10px;">`).join('')}</div>
<h3>${p.title}</h3>
<p style="font-size:13px;opacity:0.8;">${p.desc}</p>
<a href="tel:${p.phone}" class="btn">ğŸ“ Ø§ØªØµÙ„ Ø¨Ø§Ù„Ù…Ø§Ù„Ùƒ</a>
${delBtn}
</div>`;
});
});
}

function deletePost(id){db.collection("diablo_posts").doc(id).delete();}
function filterPosts(){const q=document.getElementById('searchInput').value.toLowerCase();document.querySelectorAll('.post-card').forEach(c=>{c.style.display=c.getAttribute('data-title').includes(q)?'block':'none';});}

// Ù†Ø´Ø± Ø§Ù„Ø¹Ù‚Ø§Ø±
function openPublishModal(premium){isPremiumPost=premium;document.getElementById('modalTitle').innerText=premium?"Ù†Ø´Ø± Ù…Ù†Ø´ÙˆØ± Ù…Ù…ÙŠØ² âœ¨":"Ù†Ø´Ø± Ø¹Ù‚Ø§Ø± Ø¬Ø¯ÙŠØ¯";document.getElementById('publishModal').style.display='flex';}
function closePublishModal(){document.getElementById('publishModal').style.display='none';}
function handleFiles(files){Array.from(files).forEach(f=>{const r=new FileReader();r.onload=e=>{const id=Date.now();tempImgs.push({src:e.target.result,id:id});document.getElementById('preGrid').innerHTML+=`<div id="${id}" style="position:relative;"><img src="${e.target.result}" style="width:60px;height:60px;border-radius:5px;"><button onclick="removeImg(${id})" style="position:absolute;top:0;right:0;background:red;color:white;border:none;border-radius:50%;width:20px;height:20px;">âœ•</button></div>`;};r.readAsDataURL(f);});}
function removeImg(id){tempImgs=tempImgs.filter(i=>i.id!=id);document.getElementById(id).remove();}
function uploadToFirebase(){
const t=document.getElementById('pTitle').value,d=document.getElementById('pDesc').value,ph=document.getElementById('pPhone').value,pr=document.getElementById('pPrice').value,tp=document.getElementById('pType').value;
if(!t||tempImgs.length===0) return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„!");
let uid=currentUser?currentUser.uid:'guest';
db.collection("diablo_posts").add({title:t,desc:d,phone:ph,price:pr,type:tp,imgs:tempImgs.map(i=>i.src),time:Date.now(),isPremium:isPremiumPost,userId:uid}).then(()=>location.reload());
}

// Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
function toggleMenu(){document.getElementById('sideMenu').classList.toggle('active');document.getElementById('mainOverlay').style.display=(document.getElementById('mainOverlay').style.display==='block')?'none':'block';}
function toggleTheme(){document.body.classList.toggle('light-mode');}
function setCat(c){currentCat=c;document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');loadCloudData();}

// Ø§Ù„Ø·Ù„Ø¨Ø§Øª
function openRequestModal(){document.getElementById('requestModal').style.display='flex';}
function closeRequestModal(){document.getElementById('requestModal').style.display='none';}
function addRequest(){
let t=document.getElementById('rType').value,p=document.getElementById('rPrice').value,city=document.getElementById('rCity').value,extras=document.getElementById('rExtras').value,ph=document.getElementById('rPhone').value;
db.collection("diablo_requests").add({type:t,price:p,city:city,extras:extras,phone:ph,time:Date.now()}).then(()=>{alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­");closeRequestModal();loadRequests();});
}
function loadRequests(){
db.collection("diablo_requests").orderBy("time","desc").get().then(snap=>{
const list=document.getElementById('requestsList');list.innerHTML='';snap.forEach(doc=>{const r=doc.data();list.innerHTML+=`<div class="post-card"><h4>${r.type} - ${r.city}</h4><p>Ø§Ù„Ø³Ø¹Ø±: ${r.price}$<br>Ø¥Ø¶Ø§ÙØ§Øª: ${r.extras}</p></div>`;});});
}

// Ø§Ù„Ø¨ÙˆØª
function toggleChat(){const w=document.getElementById('bot-chat-window');w.style.display=(w.style.display==='flex')?'none':'flex';}
function sendBotMsg(){
const input=document.getElementById('bot-input');const val=input.value.trim();if(!val)return;
document.getElementById('chatArea').innerHTML+=`<div class="msg user">${val}</div>`;input.value='';botLearn(val);
const resp=findBotResponse(val);document.getElementById('chatArea').innerHTML+=`<div class="msg bot">${resp}</div>`;document.getElementById('chatArea').scrollTop=document.getElementById('chatArea').scrollHeight;}
function botLearn(txt){
let words=txt.split(" ");words.forEach(w=>{if(botMemory.length>=MAX_BOT_MEMORY) botMemory.shift();botMemory.push(w);});
db.collection("bot_memory").add({text:txt,time:Date.now()});
}
function findBotResponse(q){
q=q.toLowerCase();
if(q.includes("Ø´Ù‚Ø©")||q.includes("ÙÙŠÙ„Ø§")||q.includes("Ù…Ù†Ø²Ù„")){
let found=false,html='';
db.collection("diablo_posts").get().then(snap=>{snap.forEach(doc=>{const p=doc.data();if(q.includes(p.type.toLowerCase())&&(q.includes(p.city?.toLowerCase())||!q.includes(p.city?.toLowerCase()))){html+=`- ${p.title} (${p.price}$)`;found=true;}});if(!found) html="Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†Ø´ÙˆØ±Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ø­Ø§Ù„ÙŠØ§Ù‹";document.getElementById('chatArea').innerHTML+=`<div class="msg bot">${html}</div>`;});
return "Ø¬Ø§Ø±Ù Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©...";} 
else return "Ù…Ø±Ø­Ø¨Ø§Ù‹! ÙŠÙ…ÙƒÙ†Ùƒ Ø³Ø¤Ø§Ù„ÙŠ Ø¹Ù† Ø´Ù‚Ù‚ØŒ ÙÙŠÙ„Ø§ØªØŒ Ø£Ùˆ Ù…Ù†Ø§Ø²Ù„ ÙÙŠ Ø§Ù„Ù…Ø¯Ù† ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ø®ØªÙ„ÙØ©.";}

// Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø© ÙˆØ§Ù„Ø®ØµÙˆØµÙŠØ©
function showPremiumPage(){document.getElementById('premiumPage').style.display='flex';}
function closePremiumPage(){document.getElementById('premiumPage').style.display='none';}
function showPrivacy(){alert("Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø®ØµÙˆØµÙŠØ©: Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ³ØªØ®Ø¯Ù… Firebase Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª Ø¨Ø´ÙƒÙ„ Ù…Ø¤Ù‚Øª ÙˆØ®ØµÙŠØµ.");}
</script>
</body>
</html>
