<!DOCTYPE html>
<html lang="ar" dir="rtl" id="diablo-app">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Diablo Hub | New Generation</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
<style>
:root{--p:#ff4500;--bg:#050505;--card:#111;--t:#fff;--border:#222;--gold:#ffd700;}
.light-mode{--bg:#f5f5f5;--card:#fff;--t:#222;--border:#ddd;}
body{background:var(--bg);color:var(--t);font-family:'Cairo',sans-serif;margin:0;padding-bottom:100px;overflow-x:hidden;}
#startScreen{display:flex;position:fixed;inset:0;background:var(--bg);z-index:9999;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:20px;}
#mainApp{display:none;}
header{padding:15px 5%;display:flex;justify-content:space-between;align-items:center;background:var(--card);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:1000;}
.search-bar{flex:1;display:flex;background:var(--bg);border:1px solid var(--border);border-radius:20px;padding:5px 15px;margin:0 10px;}
.search-bar input{border:none;background:none;color:var(--t);outline:none;width:100%;font-size:14px;}
.categories{display:flex;overflow-x:auto;gap:10px;padding:10px 5%;white-space:nowrap;}
.cat-btn{background:var(--card);border:1px solid var(--border);color:var(--t);padding:8px 15px;border-radius:20px;cursor:pointer;}
.cat-btn.active{background:var(--p);border-color:var(--p);color:white;}
.publish-btn-main{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);width:50px;height:40px;background:linear-gradient(90deg,#00f2ea 0%,#ff0050 100%);border-radius:12px;display:none;align-items:center;justify-content:center;z-index:9000;cursor:pointer;border:none;}
.publish-btn-main::after{content:'+';color:black;font-size:25px;font-weight:bold;background:white;width:25px;height:25px;border-radius:5px;display:flex;align-items:center;justify-content:center;}
.post-card{background:var(--card);border:1px solid var(--border);border-radius:15px;margin:15px 5%;padding:15px;position:relative;}
.post-card.premium{border:2px solid var(--gold);box-shadow:0 0 15px rgba(255,215,0,0.2);}
.price-tag{position:absolute;top:10px;left:10px;background:#25d366;color:white;padding:3px 12px;border-radius:20px;font-weight:bold;}
.side-menu{position:fixed;top:0;right:-100%;width:280px;height:100%;background:var(--card);z-index:9500;transition:0.4s;padding:20px;box-sizing:border-box;overflow-y:auto;}
.side-menu.active{right:0;}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:none;z-index:9400;}
.btn{background:var(--p);color:white;border:none;padding:12px;border-radius:8px;cursor:pointer;font-weight:bold;width:100%;margin-top:10px;text-align:center;text-decoration:none;display:block;}
input,textarea,select{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:1px solid var(--border);background:var(--bg);color:var(--t);box-sizing:border-box;}
#premiumPage, #publishModal, #requestModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:10001;align-items:center;justify-content:center;padding:20px;}
#premiumPage .content, #publishModal > div, #requestModal .content{background:var(--card);padding:20px;border-radius:15px;max-width:500px;width:100%;max-height:90vh;overflow-y:auto;}
.request-card-main{background:linear-gradient(45deg, #1a1a1a, #222); border:1px dashed var(--p); border-radius:15px; margin:15px 5%; padding:15px;}
.whatsapp-btn{background:#25d366; color:white; border-radius:50%; width:60px; height:60px; display:flex; align-items:center; justify-content:center; font-size:30px; margin:20px auto; cursor:pointer; text-decoration:none; box-shadow:0 5px 15px rgba(37,211,102,0.3);}
.loading-overlay{position:fixed; inset:0; background:rgba(0,0,0,0.9); display:none; flex-direction:column; align-items:center; justify-content:center; z-index:20000; color:white;}
</style>
</head>
<body>

<div id="loading" class="loading-overlay"><i class="fas fa-spinner fa-spin" style="font-size:40px;color:var(--p)"></i><p style="margin-top:15px;">Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± ÙˆÙ†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†...</p></div>

<div id="startScreen">
    <h1 style="color:var(--p);margin-bottom:5px;font-size:35px;">DIABLO HUB</h1>
    <p style="font-size:16px;opacity:0.8;">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø£Ù‚ÙˆÙ‰ Ù…Ù†ØµØ© Ø¹Ù‚Ø§Ø±ÙŠØ© ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨</p>
    <div style="width:100%;max-width:300px;margin-top:20px;">
        <button class="btn" onclick="setRole('investor')">Ø£Ù†Ø§ Ù…Ø³ØªØ«Ù…Ø± (ØªØµÙØ­ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª)</button>
        <button class="btn" style="background:#222;border:1px solid var(--p);" onclick="setRole('seller')">Ø£Ù†Ø§ Ù…Ø§Ù„Ùƒ (Ø£Ø±ÙŠØ¯ Ø§Ù„Ù†Ø´Ø±)</button>
    </div>
</div>

<div id="mainApp">
    <header>
        <button onclick="toggleMenu()" style="background:none;border:none;color:var(--p);font-size:24px;">â˜°</button>
        <div class="search-bar"><input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†Ø²Ù„ØŒ Ø´Ù‚Ø©..." oninput="filterPosts()"></div>
        <button onclick="toggleTheme()" style="background:none;border:none;color:var(--p);"><i class="fas fa-moon" id="themeIcon"></i></button>
    </header>

    <div class="categories">
        <button class="cat-btn active" onclick="setCat('Ø§Ù„ÙƒÙ„', this)">Ø§Ù„ÙƒÙ„</button>
        <button class="cat-btn" onclick="setCat('Ø´Ù‚Ù‚', this)">ğŸ™ï¸ Ø´Ù‚Ù‚</button>
        <button class="cat-btn" onclick="setCat('ÙÙŠÙ„Ø§Øª', this)">ğŸ° ÙÙŠÙ„Ø§Øª</button>
        <button class="cat-btn" onclick="setCat('Ù…Ù†Ø§Ø²Ù„', this)">ğŸ¡ Ù…Ù†Ø§Ø²Ù„</button>
        <button class="cat-btn" onclick="setCat('Ø·Ù„Ø¨Ø§Øª', this)">ğŸ“‹ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨Ø­Ø«</button>
        <button class="cat-btn" style="background:var(--gold);color:black;font-weight:bold;" onclick="showPremiumPage()">âœ¨ ØªÙ…ÙŠØ² Ø§Ù„Ø¢Ù†</button>
    </div>

    <div id="cloudFeed"></div>
    <button class="publish-btn-main" id="mainPublishBtn" onclick="openPublishModal(false)"></button>
</div>

<div id="publishModal">
    <div>
        <h3 style="color:var(--p)">Ù†Ø´Ø± Ø¹Ù‚Ø§Ø± Ø¬Ø¯ÙŠØ¯</h3>
        <select id="pType"><option value="Ø´Ù‚Ù‚">Ø´Ù‚Ø©</option><option value="ÙÙŠÙ„Ø§Øª">ÙÙŠÙ„Ø§</option><option value="Ù…Ù†Ø§Ø²Ù„">Ù…Ù†Ø²Ù„</option></select>
        <input type="text" id="pTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù‚Ø§Ø±">
        <input type="number" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±">
        <textarea id="pDesc" rows="4" placeholder="Ø§Ù„ØªÙØ§ØµÙŠÙ„..."></textarea>
        <input type="tel" id="pPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
        <label class="btn" style="background:#333;cursor:pointer;"><input type="file" id="pFiles" multiple accept="image/*" onchange="handleFiles(this.files)" style="display:none;">ğŸ“¸ Ø§Ø®ØªØ± Ø§Ù„ØµÙˆØ±</label>
        <div id="preGrid" style="display:flex;gap:10px;margin:10px 0;overflow-x:auto;"></div>
        <button class="btn" onclick="uploadToFirebase()">Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø¢Ù†</button>
        <button class="btn" style="background:#111;" onclick="closePublishModal()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<div id="requestModal">
    <div class="content">
        <h3 style="color:var(--p)">Ù…Ø§Ø°Ø§ ØªØ¨Ø­Ø« Ø¹Ù†Ù‡ØŸ âœ¨</h3>
        <input type="text" id="rCity" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©">
        <input type="number" id="rPrice" placeholder="Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©">
        <select id="rType"><option value="Ø´Ù‚Ù‚">Ø´Ù‚Ø©</option><option value="ÙÙŠÙ„Ø§Øª">ÙÙŠÙ„Ø§</option><option value="Ù…Ù†Ø§Ø²Ù„">Ù…Ù†Ø²Ù„</option></select>
        <input type="tel" id="rPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„">
        <button class="btn" onclick="addRequest()">ØªØ£ÙƒÙŠØ¯ ÙˆÙ†Ø´Ø± Ø§Ù„Ø·Ù„Ø¨</button>
        <button class="btn" style="background:#111;" onclick="closeRequestModal()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<div id="premiumPage">
    <div class="content" style="text-align:center;">
        <h2 style="color:var(--gold)">Ù„Ù…Ø§Ø°Ø§ ØªØ®ØªØ§Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ù…Ù…ÙŠØ²ØŸ âœ¨</h2>
        <ul style="text-align:right; line-height:1.8; font-size:15px;">
            <li>ğŸš€ <b>Ø§Ù†ØªØ´Ø§Ø± Ø£Ø³Ø±Ø¹:</b> ÙŠØ¸Ù‡Ø± Ø¥Ø¹Ù„Ø§Ù†Ùƒ ÙÙŠ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹.</li>
            <li>ğŸ“Œ <b>ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†:</b> ÙŠØ¨Ù‚Ù‰ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.</li>
            <li>ğŸ¨ <b>Ù„ÙˆÙ† Ø°Ù‡Ø¨ÙŠ:</b> ØªØµÙ…ÙŠÙ… ÙŠÙ„ÙØª Ø§Ù„Ø£Ù†Ø¸Ø§Ø± Ù„Ù„Ù…Ø³ØªØ«Ù…Ø±ÙŠÙ†.</li>
            <li>ğŸ’° <b>Ø³Ø¹Ø± Ù…Ù†Ø§ÙØ³:</b> Ø¨Ù€ 1$ ÙÙ‚Ø·!</li>
        </ul>
        <p style="margin-top:20px;">Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ…ÙŠØ²ØŒ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ÙˆØ§ØªØ³Ø§Ø¨:</p>
        <a href="https://wa.me/212695067840" target="_blank" class="whatsapp-btn"><i class="fab fa-whatsapp"></i></a>
        <button class="btn" style="background:#111;" onclick="closePremiumPage()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<div class="side-menu" id="sideMenu">
    <h2 style="color:var(--p)">DIABLO HUB</h2>
    <hr style="border:0;border-top:1px solid #333;margin:20px 0;">
    <button class="btn" onclick="location.reload()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button class="btn" style="background:#222;" onclick="openRequestModal()">â• Ø§Ù†Ø´Ø± Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡</button>
    <button class="btn" onclick="toggleTheme()">ğŸŒ“ Ø§Ù„Ù…Ø¸Ù‡Ø±</button>
</div>

<div class="overlay" id="mainOverlay" onclick="toggleMenu()"></div>

<script>
const firebaseConfig={apiKey:"AIzaSyCGWNteBBsejx6UISfvnTY1YmnQeom7vNg",authDomain:"daiblosmart.firebaseapp.com",projectId:"daiblosmart",storageBucket:"daiblosmart.firebasestorage.app"};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
const auth=firebase.auth();

let currentUser=null, tempImgs=[], isPremiumPost=false, currentCat='Ø§Ù„ÙƒÙ„';

auth.onAuthStateChanged(u=>{ if(u) currentUser=u; });

function setRole(role){
    document.getElementById('startScreen').style.display='none';
    document.getElementById('mainApp').style.display='block';
    if(role==='seller') document.getElementById('mainPublishBtn').style.display='flex';
    loadCloudData();
}

function loadCloudData(){
    const feed=document.getElementById('cloudFeed'); feed.innerHTML="";
    if(currentCat === 'Ø·Ù„Ø¨Ø§Øª') {
        db.collection("diablo_requests").orderBy("time","desc").onSnapshot(snap=>{
            feed.innerHTML = "<h2 style='padding:0 5%; font-size:18px;'>ğŸ“‹ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨Ø­Ø«</h2>";
            snap.forEach(doc=>{
                const r=doc.data();
                feed.innerHTML+=`<div class="request-card-main">
                    <h4 style="color:var(--p);margin:0;">ğŸš© Ù…Ø·Ù„ÙˆØ¨ ${r.type}</h4>
                    <p>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${r.city} | Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©: ${r.price}$</p>
                    <a href="tel:${r.phone}" class="btn" style="padding:5px; font-size:12px;">ğŸ“ ØªÙˆØ§ØµÙ„</a>
                </div>`;
            });
        });
    } else {
        db.collection("diablo_posts").orderBy("isPremium","desc").orderBy("time","desc").onSnapshot(snap=>{
            feed.innerHTML="";
            snap.forEach(doc=>{
                const p=doc.data();
                if(currentCat!=='Ø§Ù„ÙƒÙ„' && p.type!==currentCat) return;
                let delBtn=(currentUser && currentUser.uid===p.userId)?`<button class="btn" style="background:red;padding:5px;font-size:12px;" onclick="deletePost('${doc.id}')">Ø­Ø°Ù</button>`:'';
                feed.innerHTML+=`<div class="post-card ${p.isPremium?'premium':''}" data-title="${p.title.toLowerCase()}">
                    <span class="price-tag">${p.price}$</span>
                    <div style="display:flex;overflow-x:auto;gap:10px;margin-bottom:10px;">${p.imgs.map(i=>`<img src="${i}" style="height:160px;border-radius:10px;object-fit:cover;min-width:200px;">`).join('')}</div>
                    <h3 style="margin:5px 0;">${p.title}</h3><p style="font-size:14px; opacity:0.9;">${p.desc}</p>
                    <div style="display:flex;gap:5px;"><a href="tel:${p.phone}" class="btn" style="flex:1;">ğŸ“ Ø§ØªØµØ§Ù„</a>${delBtn}</div></div>`;
            });
        });
    }
}

function deletePost(id){ if(confirm("Ø­Ø°ÙØŸ")) db.collection("diablo_posts").doc(id).delete(); }

function setCat(cat, btn){
    currentCat = cat;
    document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    loadCloudData();
}

function toggleMenu(){
    let menu = document.getElementById('sideMenu'), overlay = document.getElementById('mainOverlay');
    let isActive = menu.style.right === '0px';
    menu.style.right = isActive ? '-100%' : '0px';
    overlay.style.display = isActive ? 'none' : 'block';
}

function toggleTheme(){
    document.body.classList.toggle('light-mode');
    document.getElementById('themeIcon').className = document.body.classList.contains('light-mode') ? 'fas fa-sun' : 'fas fa-moon';
}

function filterPosts(){
    let q = document.getElementById('searchInput').value.toLowerCase();
    document.querySelectorAll('.post-card').forEach(c=>{ c.style.display = c.getAttribute('data-title').includes(q) ? 'block' : 'none'; });
}

function openPublishModal(p){ isPremiumPost=p; document.getElementById('publishModal').style.display='flex'; }
function closePublishModal(){ document.getElementById('publishModal').style.display='none'; }

async function handleFiles(files){
    for(let f of Array.from(files)){
        const compressedDataUrl = await compressImage(f);
        let id = Date.now() + Math.random();
        tempImgs.push({src: compressedDataUrl, id: id});
        document.getElementById('preGrid').innerHTML+=`<div id="${id}" style="position:relative; min-width:80px;"><img src="${compressedDataUrl}" style="width:80px;height:80px;border-radius:8px; object-fit:cover;"><button onclick="removeImg(${id})" style="position:absolute;top:-5px;right:-5px;background:red;color:white;border:none;border-radius:50%;width:22px;height:22px;">âœ•</button></div>`;
    }
}

function compressImage(file) {
    return new Promise((resolve) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = (event) => {
            const img = new Image();
            img.src = event.target.result;
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const maxWidth = 800;
                const scale = maxWidth / img.width;
                canvas.width = maxWidth;
                canvas.height = img.height * scale;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                resolve(canvas.toDataURL('image/jpeg', 0.6));
            };
        };
    });
}

function removeImg(id){ tempImgs=tempImgs.filter(i=>i.id!=id); document.getElementById(id).remove(); }

async function uploadToFirebase(){
    const t=document.getElementById('pTitle').value, d=document.getElementById('pDesc').value, ph=document.getElementById('pPhone').value, pr=document.getElementById('pPrice').value, tp=document.getElementById('pType').value;
    if(!t || !pr || tempImgs.length===0) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");
    document.getElementById('loading').style.display='flex';
    try {
        await db.collection("diablo_posts").add({title:t, desc:d, phone:ph, price:pr, type:tp, imgs:tempImgs.map(i=>i.src), time:Date.now(), isPremium:isPremiumPost, userId:currentUser?currentUser.uid:'guest'});
        alert("ØªÙ… Ø§Ù„Ù†Ø´Ø±!");
        location.reload();
    } catch(e) {
        alert("ÙØ´Ù„ Ø§Ù„Ù†Ø´Ø±.");
        document.getElementById('loading').style.display='none';
    }
}

function openRequestModal(){ document.getElementById('requestModal').style.display='flex'; }
function closeRequestModal(){ document.getElementById('requestModal').style.display='none'; }

function addRequest(){
    const city=document.getElementById('rCity').value, price=document.getElementById('rPrice').value, type=document.getElementById('rType').value, phone=document.getElementById('rPhone').value;
    if(!city || !price || !phone) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
    db.collection("diablo_requests").add({city, price, type, phone, time:Date.now()})
    .then(()=>{ alert("ØªÙ… Ø§Ù„Ù†Ø´Ø±!"); closeRequestModal(); currentCat='Ø·Ù„Ø¨Ø§Øª'; loadCloudData(); });
}

function showPremiumPage(){ document.getElementById('premiumPage').style.display='flex'; }
function closePremiumPage(){ document.getElementById('premiumPage').style.display='none'; }
</script>
</body>
            </html>
            
