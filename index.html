<!DOCTYPE html>
<html lang="ar" dir="rtl" id="diablo-app">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Diablo Hub | Pro Edition</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>

    <style>
        :root { --p: #ff4500; --bg: #050505; --card: #111; --t: #fff; --border: #222; --gold: #ffd700; }
        .light-mode { --bg: #f5f5f5; --card: #fff; --t: #222; --border: #ddd; }
        body { background: var(--bg); color: var(--t); font-family: 'Cairo', sans-serif; margin: 0; padding-bottom: 120px; transition: 0.3s; }
        
        /* Header & Search */
        header { padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: var(--card); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 1000; gap: 10px; }
        .search-bar { flex: 1; display: flex; background: var(--bg); border: 1px solid var(--border); border-radius: 20px; padding: 5px 15px; }
        .search-bar input { border: none; background: none; color: var(--t); outline: none; width: 100%; font-size: 14px; }

        /* Floating Publish Button (TikTok Style) */
        .publish-btn-main { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 65px; height: 45px; background: linear-gradient(90deg, #00f2ea 0%, #ff0050 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; z-index: 4500; cursor: pointer; border: none; box-shadow: 0 0 15px rgba(0,0,0,0.5); }
        .publish-btn-main::after { content: '+'; color: black; font-size: 30px; font-weight: bold; background: white; width: 30px; height: 30px; border-radius: 6px; display: flex; align-items: center; justify-content: center; }

        /* Posts & Premium */
        .post-card { background: var(--card); border: 1px solid var(--border); border-radius: 15px; margin: 0 5% 20px 5%; padding: 15px; position: relative; transition: 0.3s; }
        .post-card.premium { border: 2px solid var(--gold); box-shadow: 0 0 20px rgba(255, 215, 0, 0.2); }
        .price-tag { position: absolute; top: 10px; left: 10px; background: #25d366; color: white; padding: 3px 12px; border-radius: 20px; font-weight: bold; z-index: 10; }

        /* Sidebar & Menu */
        .side-menu { position: fixed; top: 0; right: -100%; width: 280px; height: 100%; background: var(--card); z-index: 8000; transition: 0.4s; padding: 20px; overflow-y: auto; }
        .side-menu.active { right: 0; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; z-index: 7500; }

        /* Bot Chat Window */
        #bot-chat-window { position: fixed; bottom: 100px; left: 20px; width: 320px; height: 450px; background: var(--card); border: 1px solid var(--p); border-radius: 15px; display: none; flex-direction: column; z-index: 6000; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .chat-area { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px 15px; border-radius: 15px; max-width: 80%; font-size: 13px; }
        .msg.bot { background: #222; align-self: flex-start; border-bottom-left-radius: 2px; }
        .msg.user { background: var(--p); align-self: flex-end; border-bottom-right-radius: 2px; }

        .lang-btn { background: none; border: 1px solid var(--p); color: var(--p); border-radius: 20px; padding: 4px 10px; font-size: 12px; cursor: pointer; }
        
        .premium-box { background: linear-gradient(45deg, #1a1a1a, #000); border: 1px solid var(--gold); border-radius: 12px; padding: 15px; text-align: center; margin: 10px 0; }
    </style>
</head>
<body>

<header>
    <button onclick="toggleMenu()" style="background:none; border:none; color:var(--p); font-size:24px;">â˜°</button>
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù‚Ø§Ø±..." oninput="filterPosts()">
    </div>
    <div style="display:flex; gap:5px;">
        <button class="lang-btn" onclick="toggleLang()">EN/Ø¹Ø±Ø¨ÙŠ</button>
        <button onclick="toggleTheme()" class="lang-btn">MODE</button>
    </div>
</header>

<div class="categories">
    <button class="cat-btn active" onclick="setCat('Ø§Ù„ÙƒÙ„')">Ø§Ù„ÙƒÙ„</button>
    <button class="cat-btn" onclick="setCat('Ø´Ù‚Ù‚')">ğŸ™ï¸ Ø´Ù‚Ù‚</button>
    <button class="cat-btn" onclick="setCat('ÙÙŠÙ„Ø§Øª')">ğŸ° ÙÙŠÙ„Ø§Øª</button>
    <button class="cat-btn" onclick="setCat('Ù…Ù†Ø§Ø²Ù„')">ğŸ¡ Ù…Ù†Ø§Ø²Ù„</button>
</div>

<div id="homePageContent">
    <div id="cloudFeed"></div>
</div>

<button class="publish-btn-main" id="mainPublishBtn" onclick="togglePublishModal()"></button>

<div class="publish-modal" id="publishModal">
    <div class="modal-content">
        <h3 id="pubTitle" style="color:var(--p)">Ù†Ø´Ø± Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯</h3>
        <select id="pType"><option value="Ø´Ù‚Ù‚">Ø´Ù‚Ø©</option><option value="ÙÙŠÙ„Ø§Øª">ÙÙŠÙ„Ø§</option><option value="Ù…Ù†Ø§Ø²Ù„">Ù…Ù†Ø²Ù„</option></select>
        <input type="text" id="pTitle" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
        <input type="number" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
        <textarea id="pDesc" rows="4" placeholder="Ø§Ù„ØªÙØ§ØµÙŠÙ„..."></textarea>
        <input type="tel" id="pPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
        
        <label class="custom-file-upload">
            <input type="file" id="pFiles" multiple accept="image/*" onchange="handleFiles(this.files)" style="display:none;">
            <i class="fas fa-camera"></i> Ø£Ø¶Ù ØµÙˆØ± Ø§Ù„Ø¹Ù‚Ø§Ø±
        </label>
        <div id="preGrid" style="display:flex; gap:5px; margin:10px 0; overflow-x:auto;"></div>
        
        <button class="btn" onclick="uploadToFirebase()">Ù†Ø´Ø± Ø§Ù„Ø¢Ù†</button>
        <button class="btn" style="background:#333;" onclick="togglePublishModal()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<div class="side-menu" id="sideMenu">
    <h3 style="color:var(--p)">DIABLO HUB</h3>
    
    <div class="premium-box">
        <h4 style="color:var(--gold); margin:0;">âœ¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©</h4>
        <p style="font-size:11px;">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¢Ù„Ø§Ù Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ù…Ù‚Ø§Ø¨Ù„ 1$ ÙÙ‚Ø·!</p>
        <a href="https://wa.me/212695067840" target="_blank" style="color:inherit; text-decoration:none;">
            <button class="btn" style="background:#25d366; color:white;"><i class="fab fa-whatsapp"></i> ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙŠ Ù„Ù„ØªÙ…ÙŠØ²</button>
        </a>
    </div>

    <div id="adminPanel" style="display:none; border:1px dashed var(--gold); padding:10px; margin-top:10px;">
        <p style="color:var(--gold); font-size:12px;">Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</p>
        <button class="btn" style="background:var(--gold); color:black;" onclick="setPostingType(true)">Ù†Ø´Ø± Ù…Ù†Ø´ÙˆØ± Ù…Ù…ÙŠØ² âœ¨</button>
    </div>

    <hr>
    <button class="btn" onclick="showPage('privacy')">ğŸ›¡ï¸ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</button>
    <button class="btn" onclick="showPage('disclaimer')">âš ï¸ Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©</button>
    <button class="btn" style="background:red;" onclick="auth.signOut().then(()=>location.reload())">Ø®Ø±ÙˆØ¬</button>
</div>

<div id="privacyPage" class="legal-page">
    <button class="btn" onclick="showPage('home')">âœ• Ø±Ø¬ÙˆØ¹</button>
    <h2>Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</h2>
    <p>Ù†Ø­Ù† Ù†Ø­Ù…ÙŠ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆÙ„Ø§ Ù†Ø´Ø§Ø±ÙƒÙ‡Ø§ Ù…Ø¹ Ø£ÙŠ Ø·Ø±Ù Ø«Ø§Ù„Ø«...</p>
</div>
<div id="disclaimerPage" class="legal-page">
    <button class="btn" onclick="showPage('home')">âœ• Ø±Ø¬ÙˆØ¹</button>
    <h2>Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©</h2>
    <p>Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ³ÙŠØ· ÙÙ‚Ø·ØŒ ÙˆÙ„Ø³Ù†Ø§ Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† Ø¹Ù† Ø£ÙŠ ØªØ¹Ø§Ù…Ù„Ø§Øª Ù…Ø§Ù„ÙŠØ© ØªØªÙ… Ø¨ÙŠÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...</p>
</div>

<div id="diablo-bot-icon" onclick="toggleChat()">ğŸ¤–</div>
<div id="bot-chat-window">
    <div style="background:var(--p); padding:10px; color:white; display:flex; justify-content:space-between;">
        <span>Ø¯ÙŠØ§Ø¨Ù„Ùˆ Ø¨ÙˆØª (Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ)</span>
        <span onclick="toggleChat()" style="cursor:pointer">âœ•</span>
    </div>
    <div class="chat-area" id="chatArea"></div>
    <div style="display:flex; padding:10px; border-top:1px solid var(--border);">
        <input type="text" id="bot-input" style="flex:1; border:none; background:none; color:var(--t);" placeholder="ØªØ­Ø¯Ø« Ù…Ø¹ÙŠ...">
        <button onclick="sendMessageToBot()" style="border:none; background:none; color:var(--p); font-size:18px;"><i class="fas fa-paper-plane"></i></button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCGWNteBBsejx6UISfvnTY1YmnQeom7vNg",
        authDomain: "daiblosmart.firebaseapp.com",
        projectId: "daiblosmart",
        storageBucket: "daiblosmart.firebasestorage.app",
        messagingSenderId: "948075676362",
        appId: "1:948075676362:web:c27d582068712cbe13aa33"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    let tempImgs = [], currentCat = 'Ø§Ù„ÙƒÙ„', currentUser = null, isAdmin = false, isPremiumPost = false;

    auth.onAuthStateChanged(user => {
        if(user) {
            currentUser = user;
            if(user.email === "diablo@admin.com") {
                isAdmin = true;
                document.getElementById('adminPanel').style.display = 'block';
            }
            loadCloudData();
        }
    });

    function filterPosts() {
        const val = document.getElementById('searchInput').value.toLowerCase();
        document.querySelectorAll('.post-card').forEach(card => {
            const title = card.querySelector('h3').innerText.toLowerCase();
            card.style.display = title.includes(val) ? 'block' : 'none';
        });
    }

    function setPostingType(premium) {
        isPremiumPost = premium;
        togglePublishModal();
        document.getElementById('pubTitle').innerText = premium ? "Ù†Ø´Ø± Ù…Ù†Ø´ÙˆØ± Ù…Ù…ÙŠØ² âœ¨" : "Ù†Ø´Ø± Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯";
    }

    function loadCloudData() {
        db.collection("diablo_posts").orderBy("time", "desc").onSnapshot(snap => {
            const feed = document.getElementById('cloudFeed'); feed.innerHTML = "";
            snap.forEach(doc => {
                const p = doc.data();
                if(currentCat !== 'Ø§Ù„ÙƒÙ„' && p.type !== currentCat) return;
                feed.innerHTML += `
                    <div class="post-card ${p.isPremium ? 'premium' : ''}">
                        ${p.isPremium ? '<span style="color:gold; font-size:10px;"><i class="fas fa-star"></i> Ù…Ù…ÙŠØ²</span>' : ''}
                        <span class="price-tag">${p.price}$</span>
                        <div style="display:flex; overflow-x:auto; gap:10px;">${p.imgs.map(i => `<img src="${i}" style="height:150px; border-radius:10px;">`).join('')}</div>
                        <h3>${p.title}</h3>
                        <p style="font-size:13px; color:#aaa;">${p.desc}</p>
                        <a href="tel:${p.phone}" style="background:var(--p); color:white; padding:10px; border-radius:8px; text-decoration:none; display:block; text-align:center;">ğŸ“ Ø§ØªØµÙ„ Ø§Ù„Ø¢Ù†</a>
                        ${(isAdmin || (currentUser && p.userId === currentUser.uid)) ? `<button onclick="deletePost('${doc.id}')" style="color:red; background:none; border:none; margin-top:10px;">ğŸ—‘ï¸ Ø­Ø°Ù</button>` : ''}
                    </div>`;
            });
        });
    }

    function uploadToFirebase() {
        const t = document.getElementById('pTitle').value, d = document.getElementById('pDesc').value, ph = document.getElementById('pPhone').value, pr = document.getElementById('pPrice').value, tp = document.getElementById('pType').value;
        if(!t || tempImgs.length === 0) return alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©!");
        db.collection("diablo_posts").add({ 
            title: t, desc: d, phone: ph, price: pr, type: tp, 
            imgs: tempImgs.map(i => i.src), 
            time: Date.now(), 
            userId: currentUser.uid,
            isPremium: isPremiumPost
        }).then(() => { location.reload(); });
    }

    // Bot Logic
    function toggleChat() {
        const win = document.getElementById('bot-chat-window');
        const open = win.style.display === 'flex';
        win.style.display = open ? 'none' : 'flex';
        if(!open && document.getElementById('chatArea').innerHTML === "") {
            addMsg("Ù…Ø±Ø­Ø¨Ø§! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø¯ÙŠØ§Ø¨Ù„Ùˆ ğŸ¤– ÙƒÙŠÙ Ø£Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ", 'bot');
            setTimeout(() => addMsg("ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù†Ø´Ø± Ø¹Ø¨Ø± Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± (+) ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ØŒ Ø£Ùˆ Ø·Ù„Ø¨ Ù…Ù†Ø´ÙˆØ± Ù…Ù…ÙŠØ² Ù„ØªØµØ¯Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©!", 'bot'), 1000);
        }
    }

    function addMsg(text, sender) {
        const div = document.createElement('div');
        div.className = `msg ${sender}`;
        div.innerText = text;
        document.getElementById('chatArea').appendChild(div);
        document.getElementById('chatArea').scrollTop = document.getElementById('chatArea').scrollHeight;
    }

    function sendMessageToBot() {
        const input = document.getElementById('bot-input');
        if(!input.value) return;
        addMsg(input.value, 'user');
        const userText = input.value.toLowerCase();
        input.value = "";
        
        setTimeout(() => {
            if(userText.includes("Ù†Ø´Ø±")) addMsg("Ù„Ù„Ù†Ø´Ø±ØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± (+) Ø§Ù„Ù…Ù„ÙˆÙ† Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø©.", 'bot');
            else if(userText.includes("ØªÙ…ÙŠØ²") || userText.includes("Ø¯ÙˆÙ„Ø§Ø±")) addMsg("Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø§Ù„Ù…Ù…ÙŠØ² ÙŠØ¬Ø¹Ù„Ùƒ ÙÙŠ Ø§Ù„ØµØ¯Ø§Ø±Ø©! ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ± Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©.", 'bot');
            else addMsg("Ø£Ù†Ø§ Ù…Ø¹Ùƒ! Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø´Ù‚Ù‚ Ø£Ù… ÙÙŠÙ„Ø§ØªØŸ", 'bot');
        }, 800);
    }

    function handleFiles(files) {
        Array.from(files).forEach(f => {
            const r = new FileReader();
            r.onload = e => {
                const id = Date.now();
                tempImgs.push({src: e.target.result, id: id});
                document.getElementById('preGrid').innerHTML += `<div id="${id}" style="position:relative"><img src="${e.target.result}" style="width:60px;height:60px;border-radius:5px;"><button onclick="removeImg(${id})" style="position:absolute;top:0;right:0;background:red;color:white;border:none;border-radius:50%;width:20px;height:20px;">âœ•</button></div>`;
            };
            r.readAsDataURL(f);
        });
    }
    function removeImg(id) { tempImgs = tempImgs.filter(i => i.id != id); document.getElementById(id).remove(); }
    function togglePublishModal() { const m = document.getElementById('publishModal'); m.style.display = (m.style.display === 'flex') ? 'none' : 'flex'; }
    function toggleMenu() { document.getElementById('sideMenu').classList.toggle('active'); document.getElementById('overlay').style.display = (document.getElementById('overlay').style.display==='block')?'none':'block'; }
    function toggleTheme() { document.body.classList.toggle('light-mode'); }
    function showPage(p) { document.querySelectorAll('.legal-page, #homePageContent').forEach(d => d.style.display='none'); document.getElementById(p+'Page').style.display='block'; toggleMenu(); }
    function setCat(c) { currentCat = c; document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active')); event.target.classList.add('active'); loadCloudData(); }
</script>
</body>
    </html>
    
