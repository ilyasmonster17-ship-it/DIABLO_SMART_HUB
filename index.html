<!DOCTYPE html>
<html lang="ar" dir="rtl" id="diablo-app">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diablo Hub | Investment & Real Estate</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>

    <style>
        :root { --p: #ff4500; --bg: #050505; --card: #111; --t: #fff; --border: #222; --bot-bg: #444; }
        .light-mode { --bg: #f5f5f5; --card: #fff; --t: #222; --border: #ddd; --bot-bg: #eee; }
        
        body { background: var(--bg); color: var(--t); font-family: 'Cairo', sans-serif; margin: 0; transition: 0.3s; }
        header { padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: var(--card); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 1000; }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« */
        .search-container { padding: 10px 5%; background: var(--card); border-bottom: 1px solid var(--border); }
        .search-box { width: 100%; padding: 12px; border-radius: 25px; border: 1px solid var(--p); background: var(--bg); color: var(--t); outline: none; }

        .side-menu { position: fixed; top: 0; right: -280px; width: 280px; height: 100%; background: var(--card); z-index: 3000; transition: 0.4s; padding: 20px; border-left: 1px solid var(--border); }
        .side-menu.active { right: 0; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: none; z-index: 2500; }

        .post-card { background: var(--card); border: 1px solid var(--border); border-radius: 15px; margin-bottom: 25px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .img-slider { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px; }
        .img-slider img { height: 180px; border-radius: 10px; }

        .investor-tools { background: rgba(255, 69, 0, 0.1); border: 1px dashed var(--p); border-radius: 10px; padding: 10px; margin-top: 15px; display: none; }
        
        .chat-win { position: fixed; bottom: 85px; left: 20px; width: 320px; height: 450px; background: var(--card); border: 2px solid var(--p); border-radius: 15px; display: none; flex-direction: column; z-index: 2000; }
        .msg { padding: 10px; border-radius: 10px; max-width: 85%; margin: 5px 0; font-size: 0.9rem; }
        .bot { background: var(--p); color: white; align-self: flex-start; }
        .user { background: var(--bot-bg); color: var(--t); align-self: flex-end; }

        .btn { background: var(--p); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--t); box-sizing: border-box; }
        
        .page-content { display: none; padding: 20px 5%; }
        .pre-item { position: relative; display: inline-block; margin-right: 5px; }
        .pre-item img { height: 60px; width: 60px; border-radius: 5px; }
        .del-btn { position: absolute; top: -5px; right: -5px; background: red; color: white; border: none; border-radius: 50%; width: 18px; height: 18px; cursor: pointer; font-size: 10px; }
    </style>
</head>
<body>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<div class="side-menu" id="sideMenu">
    <h2 style="color:var(--p)">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
    <a href="#" style="display:block; color:var(--t); padding:10px;" onclick="showPage('home')">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="#" style="display:block; color:var(--t); padding:10px;" onclick="showPage('privacy')">ğŸ”’ Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
    <button class="btn" style="margin-top: 20px;" onclick="toggleMenu()">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<header>
    <div style="display:flex; align-items:center; gap:10px;">
        <button onclick="toggleMenu()" style="background:none; border:none; color:var(--p); font-size:24px; cursor:pointer;">â˜°</button>
        <div style="font-weight:bold; color:var(--p); font-size:1.4rem;">DIABLO HUB</div>
    </div>
    <button onclick="toggleTheme()" style="background:none; border:1px solid var(--p); color:var(--p); border-radius:20px; padding:5px 15px; cursor:pointer;">ğŸŒ“</button>
</header>

<div class="search-container" id="searchContainer" style="display:none;">
    <input type="text" id="searchInput" class="search-box" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø­ÙŠØŒ Ø£Ùˆ Ù†ÙˆØ¹ Ø¹Ù‚Ø§Ø±..." onkeyup="filterPosts()">
</div>

<div id="homePage" class="page-content" style="display:block;">
    <div id="roleSelection" style="text-align:center; padding: 50px 0;">
        <h2 style="color:var(--p)">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¯ÙŠØ§Ø¨Ù„Ùˆ Ù‡Ø¨</h2>
        <button class="btn" onclick="initApp('investor')" style="max-width:300px;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±ÙŠÙ† (Ø£Ø¯ÙˆØ§Øª Ø°ÙƒÙŠØ©)</button>
        <button class="btn" onclick="initApp('seller')" style="max-width:300px; margin-top:10px; background:#333;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù„Ø§Ùƒ (Ù†Ø´Ø± Ø¹Ø±Ø¶)</button>
    </div>

    <div id="uploadArea" style="display:none; background:var(--card); padding:20px; border-radius:15px; border:1px solid var(--border); margin-bottom:30px;">
        <h3>ğŸ“¤ Ø¥Ø¶Ø§ÙØ© Ø¹Ø±Ø¶ Ø¬Ø¯ÙŠØ¯</h3>
        <input type="text" id="pTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù‚Ø§Ø±...">
        <textarea id="pDesc" rows="3" placeholder="Ø§Ù„ÙˆØµÙ ÙˆØ§Ù„Ø³Ø¹Ø± (Ù…Ø«Ù„Ø§Ù‹: 500,000 Ø¯Ø±Ù‡Ù…)..."></textarea>
        <input type="file" id="pFiles" multiple accept="image/*" onchange="handleFiles(this.files)">
        <div id="preGrid" style="display:flex; gap:10px; overflow-x:auto; margin:10px 0;"></div>
        <button class="btn" id="pubBtn" onclick="uploadToFirebase()">Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
    </div>

    <div id="cloudFeed"></div>
</div>

<div id="privacyPage" class="page-content">
    <h1>ğŸ”’ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</h1>
    <p>Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø­Ù…ÙŠØ© Ø¨Ø³ÙŠØ±ÙØ±Ø§Øª Firebase Ø§Ù„Ù…Ø´ÙØ±Ø©.</p>
    <button class="btn" onclick="showPage('home')">Ø¹ÙˆØ¯Ø©</button>
</div>

<div class="chat-win" id="chatWindow">
    <div style="background:var(--p); padding:10px; font-weight:bold; color:white;">ğŸ¤– Ø¯ÙŠØ§Ø¨Ù„Ùˆ Ø§Ù„Ø°ÙƒÙŠ</div>
    <div id="chatBody" style="flex:1; padding:15px; overflow-y:auto; display:flex; flex-direction:column; gap:10px;"></div>
    <div style="display:flex; padding:10px; border-top:1px solid var(--border);">
        <input type="text" id="chatInput" placeholder="Ø§Ø³Ø£Ù„ Ø¯ÙŠØ§Ø¨Ù„Ùˆ..." style="margin:0; border:none; outline:none; background:transparent; color:var(--t);">
        <button onclick="askDiablo()" style="background:var(--p); border:none; color:white; padding:5px 15px; border-radius:5px;">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
</div>
<button onclick="toggleChat()" style="position:fixed; bottom:20px; left:20px; background:var(--p); border:none; width:60px; height:60px; border-radius:50%; font-size:25px; color:white; cursor:pointer; z-index:1001;">ğŸ’¬</button>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCGWNteBBsejx6UISfvnTY1YmnQeom7vNg",
        authDomain: "daiblosmart.firebaseapp.com",
        projectId: "daiblosmart",
        storageBucket: "daiblosmart.firebasestorage.app",
        messagingSenderId: "948075676362",
        appId: "1:948075676362:web:c27d582068712cbe13aa33"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    let tempImgs = [];
    let userRole = '';
    let allPosts = [];

    function initApp(role) {
        userRole = role;
        document.getElementById('roleSelection').style.display = 'none';
        document.getElementById('searchContainer').style.display = 'block';
        if(role === 'seller') document.getElementById('uploadArea').style.display = 'block';
        loadCloudData();
    }

    function handleFiles(files) {
        Array.from(files).forEach(f => {
            const r = new FileReader();
            r.onload = e => {
                const id = Date.now() + Math.random();
                tempImgs.push({id: id, src: e.target.result});
                renderPreviews();
            };
            r.readAsDataURL(f);
        });
    }

    function renderPreviews() {
        const grid = document.getElementById('preGrid');
        grid.innerHTML = tempImgs.map(img => `
            <div class="pre-item">
                <img src="${img.src}">
                <button class="del-btn" onclick="removeImg(${img.id})">âœ•</button>
            </div>
        `).join('');
    }

    function removeImg(id) {
        tempImgs = tempImgs.filter(i => i.id !== id);
        renderPreviews();
    }

    function uploadToFirebase() {
        const title = document.getElementById('pTitle').value;
        const desc = document.getElementById('pDesc').value;
        if(!title || tempImgs.length === 0) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");
        db.collection("diablo_posts").add({
            title, desc, imgs: tempImgs.map(i => i.src), time: Date.now()
        }).then(() => location.reload());
    }

    function loadCloudData() {
        db.collection("diablo_posts").orderBy("time", "desc").onSnapshot(snap => {
            allPosts = [];
            snap.forEach(doc => allPosts.push(doc.data()));
            renderPosts(allPosts);
        });
    }

    function renderPosts(posts) {
        const feed = document.getElementById('cloudFeed');
        feed.innerHTML = posts.map(p => `
            <div class="post-card">
                <div class="img-slider">${p.imgs.map(i => `<img src="${i}">`).join('')}</div>
                <h3>${p.title}</h3>
                <p>${p.desc}</p>
                ${userRole === 'investor' ? `
                    <div class="investor-tools" style="display:block;">
                        <small>ğŸ“ˆ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±:</small>
                        <div style="display:flex; gap:10px; margin-top:5px;">
                            <button onclick="calcROI()" style="font-size:11px; padding:4px;">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ø¯</button>
                            <button onclick="alert('ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØµÙÙ‚Ø©: Ø¬ÙŠØ¯Ø© Ø¬Ø¯Ø§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù‚Ø§Ø±')" style="font-size:11px; padding:4px;">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</button>
                        </div>
                    </div>
                ` : ''}
                <div style="margin-top:10px;"><small>ğŸ“… ${new Date(p.time).toLocaleDateString()}</small></div>
            </div>
        `).join('');
    }

    function filterPosts() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        const filtered = allPosts.filter(p => 
            p.title.toLowerCase().includes(term) || p.desc.toLowerCase().includes(term)
        );
        renderPosts(filtered);
    }

    function calcROI() {
        const price = prompt("Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± Ø§Ù„Ø¹Ù‚Ø§Ø± Ø¨Ø§Ù„Ø¯Ø±Ù‡Ù…:");
        const rent = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:");
        if(price && rent) {
            const roi = ((rent * 12) / price) * 100;
            alert("Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ù‡Ùˆ: " + roi.toFixed(2) + "%");
        }
    }

    function toggleTheme() { document.body.classList.toggle('light-mode'); }
    function toggleMenu() { document.getElementById('sideMenu').classList.toggle('active'); document.getElementById('overlay').style.display = (document.getElementById('overlay').style.display === 'block' ? 'none' : 'block'); }
    function showPage(p) { document.querySelectorAll('.page-content').forEach(c => c.style.display='none'); document.getElementById(p+'Page').style.display='block'; toggleMenu(); }
    function toggleChat() { let w = document.getElementById('chatWindow'); w.style.display = (w.style.display === 'flex' ? 'none' : 'flex'); }
    
    function askDiablo() {
        const inp = document.getElementById('chatInput');
        const body = document.getElementById('chatBody');
        if(!inp.value) return;
        body.innerHTML += `<div class="msg user">${inp.value}</div>`;
        let r = "Ø¯ÙŠØ§Ø¨Ù„Ùˆ: Ø¨ØµÙØªÙŠ Ø®Ø¨ÙŠØ±Ø§Ù‹ Ø¹Ù‚Ø§Ø±ÙŠØ§Ù‹ØŒ Ø£Ù†ØµØ­Ùƒ Ø¨Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¹Ø§Ø¦Ø¯ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù…Ø¹ Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ Ø§Ù„Ù…Ø¬Ø§ÙˆØ±Ø©.";
        if(inp.value.includes("Ø§Ø³ØªØ«Ù…Ø§Ø±")) r = "Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± ÙÙŠ Ø§Ù„Ø´Ù‚Ù‚ Ø§Ù„ØµØºÙŠØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ ÙŠØ¹Ø·ÙŠ Ø¹Ø§Ø¦Ø¯Ø§Ù‹ Ø£Ø³Ø±Ø¹ ÙÙŠ Ø§Ù„Ù…Ø¯Ù† Ø§Ù„ÙƒØ¨Ø±Ù‰.";
        setTimeout(() => { body.innerHTML += `<div class="msg bot">${r}</div>`; body.scrollTop = body.scrollHeight; }, 600);
        inp.value = "";
    }
</script>
</body>
</html>
