<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Diablo Hub | Morocco</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <style>
        :root{--p:#ff4500;--bg:#050505;--card:#111;--t:#fff;--border:#222;--gold:#ffd700;}
        .light-mode{--bg:#f5f5f5;--card:#fff;--t:#222;--border:#ddd;}
        body{background:var(--bg);color:var(--t);font-family:'Cairo',sans-serif;margin:0;padding-bottom:100px;overflow-x:hidden;}
        #startScreen{display:flex;position:fixed;inset:0;background:var(--bg);z-index:9999;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:20px;}
        #mainApp{display:none;}
        header{padding:15px 5%;display:flex;justify-content:space-between;align-items:center;background:var(--card);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:1000;}
        
        /* Chat Bot Widget Style */
        #botBtn{position:fixed;bottom:20px;right:20px;width:60px;height:60px;background:var(--p);border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-size:25px;cursor:pointer;z-index:9999;box-shadow:0 4px 15px rgba(255,69,0,0.4);}
        #botChat{position:fixed;bottom:90px;right:20px;width:320px;height:450px;background:var(--card);border:1px solid var(--border);border-radius:15px;display:none;flex-direction:column;z-index:9999;box-shadow:0 5px 25px rgba(0,0,0,0.5);overflow:hidden;}
        #chatHeader{background:var(--p);padding:15px;color:white;font-weight:bold;display:flex;justify-content:space-between;}
        #chatBox{flex:1;padding:15px;overflow-y:auto;display:flex;flex-direction:column;gap:10px;background:var(--bg);}
        .msg{padding:8px 12px;border-radius:10px;max-width:80%;font-size:14px;line-height:1.4;}
        .bot-msg{background:var(--border);align-self:flex-start;color:var(--t);}
        .user-msg{background:var(--p);align-self:flex-end;color:white;}
        #chatInputArea{padding:10px;background:var(--card);display:flex;gap:5px;border-top:1px solid var(--border);}
        
        /* Existing Styles */
        .side-menu{position:fixed;top:0;right:-100%;width:280px;height:100%;background:var(--card);z-index:9500;transition:0.4s;padding:20px;box-sizing:border-box;border-left:1px solid var(--border);overflow-y:auto;}
        .side-menu.active{right:0;}
        .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:none;z-index:9400;}
        .search-container{padding:10px 5%; background:var(--bg);}
        .search-box{width:100%; padding:12px 15px; border-radius:10px; border:1px solid var(--border); background:var(--card); color:var(--t); font-family:'Cairo'; outline:none;}
        .categories{display:flex;overflow-x:auto;gap:10px;padding:10px 5%;white-space:nowrap;}
        .cat-btn{background:var(--card);border:1px solid var(--border);color:var(--t);padding:8px 15px;border-radius:20px;cursor:pointer;}
        .cat-btn.active{background:var(--p);color:white;border-color:var(--p);}
        .post-card{background:var(--card);border:1px solid var(--border);border-radius:15px;margin:15px 5%;padding:15px;position:relative;}
        .price-tag{position:absolute;top:10px;left:10px;background:#25d366;color:white;padding:3px 12px;border-radius:20px;font-weight:bold;z-index:10;}
        .btn{background:var(--p);color:white;border:none;padding:12px;border-radius:8px;cursor:pointer;font-weight:bold;width:100%;margin-top:10px;text-align:center;text-decoration:none;display:block;}
        #publishModal, #premiumPage, #policyModal, #investModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:10001;align-items:center;justify-content:center;padding:20px;}
        .modal-content{background:var(--card);padding:20px;border-radius:15px;max-width:500px;width:100%;max-height:90vh;overflow-y:auto;}
        input,textarea,select{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:1px solid var(--border);background:var(--bg);color:var(--t);box-sizing:border-box;}
        .tag-info{display:inline-block; background:rgba(255,69,0,0.1); color:var(--p); padding:2px 8px; border-radius:5px; font-size:12px; margin-top:5px; margin-left:5px;}
        .file-upload-label{display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px; border:2px dashed var(--border); border-radius:10px; cursor:pointer; color:var(--p); margin:10px 0;}
    </style>
</head>
<body>

<div id="loading" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:20000;color:white;flex-direction:column;align-items:center;justify-content:center;"><i class="fas fa-spinner fa-spin" style="font-size:40px;color:var(--p)"></i><p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</p></div>

<div id="startScreen">
    <h1 style="color:var(--p);font-size:40px;">DIABLO HUB</h1>
    <p>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø£Ù‚ÙˆÙ‰ Ù…Ù†ØµØ© Ø¹Ù‚Ø§Ø±ÙŠØ© ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨</p>
    <div style="width:100%;max-width:300px;margin-top:20px;">
        <button class="btn" onclick="setRole('investor')">ØªØµÙØ­ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</button>
        <button class="btn" style="background:#222;border:1px solid var(--p);" onclick="setRole('seller')">Ø£Ø±ÙŠØ¯ Ø§Ù„Ù†Ø´Ø± (Ù…Ø§Ù„Ùƒ)</button>
    </div>
</div>

<div id="mainApp">
    <header>
        <button onclick="toggleMenu()" style="background:none;border:none;color:var(--p);font-size:24px;">â˜°</button>
        <strong style="color:var(--p)">DIABLO HUB</strong>
        <button onclick="toggleTheme()" style="background:none;border:none;color:var(--p);font-size:20px;"><i class="fas fa-moon" id="themeIcon"></i></button>
    </header>

    <div class="search-container">
        <input type="text" id="searchInput" class="search-box" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù†: Ù…Ø³Ø¨Ø­ØŒ Ù…Ø±Ø§ÙƒØ´ØŒ Ø£Ùˆ Ù…Ø±Ø¬Ø¹..." oninput="listenToPosts()">
    </div>

    <div class="categories">
        <button class="cat-btn active" onclick="setCat('Ø§Ù„ÙƒÙ„', this)">Ø§Ù„ÙƒÙ„</button>
        <button class="cat-btn" onclick="setCat('Ø´Ù‚Ù‚', this)">ğŸ™ï¸ Ø´Ù‚Ù‚</button>
        <button class="cat-btn" onclick="setCat('ÙÙŠÙ„Ø§Øª', this)">ğŸ° ÙÙŠÙ„Ø§Øª</button>
        <button class="cat-btn" style="background:var(--gold);color:black;font-weight:bold;" onclick="showPremium()">âœ¨ ØªÙ…ÙŠØ² Ø§Ù„Ø¢Ù†</button>
    </div>

    <div id="feed"></div>
</div>

<div id="botBtn" onclick="toggleChat()"><i class="fas fa-robot"></i></div>
<div id="botChat">
    <div id="chatHeader"><span>Ù…Ø³Ø§Ø¹Ø¯ Diablo Ø§Ù„Ø°ÙƒÙŠ ğŸ¤–</span><i class="fas fa-times" onclick="toggleChat()" style="cursor:pointer;"></i></div>
    <div id="chatBox">
        <div class="msg bot-msg">Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ø¨ÙˆØª Diablo Ø§Ù„Ø°ÙƒÙŠ. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù‚Ø§Ø± Ø¨ÙƒØªØ§Ø¨Ø© Ù…ÙˆØ§ØµÙØ§ØªÙ‡.</div>
    </div>
    <div id="chatInputArea">
        <input type="text" id="botInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." onkeypress="if(event.key==='Enter') sendBotMsg()">
        <button onclick="sendBotMsg()" style="background:var(--p);border:none;color:white;padding:10px;border-radius:8px;"><i class="fas fa-paper-plane"></i></button>
    </div>
</div>

<div id="investModal"><div class="modal-content"><h3 id="invT"></h3><div id="invD"></div><button class="btn" onclick="document.getElementById('investModal').style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button></div></div>
<div id="publishModal"><div class="modal-content"><h3>Ù†Ø´Ø± Ø¹Ù‚Ø§Ø±</h3><select id="pType"><option value="Ø´Ù‚Ù‚">Ø´Ù‚Ø©</option><option value="ÙÙŠÙ„Ø§Øª">ÙÙŠÙ„Ø§</option></select><input id="pTitle" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"><input type="number" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±"><textarea id="pDesc" placeholder="Ø§Ù„ÙˆØµÙ"></textarea><input id="pExtras" placeholder="Ù…Ù…ÙŠØ²Ø§Øª"><input id="pPhone" placeholder="Ø§Ù„Ù‡Ø§ØªÙ"><label class="file-upload-label"><i class="fas fa-camera"></i><span>ØµÙˆØ± Ø§Ù„Ø¹Ù‚Ø§Ø±</span><input type="file" id="pFiles" multiple style="display:none;" onchange="handleFiles(this.files)"></label><div id="preGrid" style="display:flex;gap:5px;overflow-x:auto;"></div><button class="btn" onclick="uploadPost()">Ù†Ø´Ø±</button></div></div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyCGWNteBBsejx6UISfvnTY1YmnQeom7vNg", authDomain: "daiblosmart.firebaseapp.com", projectId: "daiblosmart", storageBucket: "daiblosmart.appspot.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const myID = localStorage.getItem('myDiabloID') || 'user_'+Math.random().toString(36).substr(2,9);
    localStorage.setItem('myDiabloID', myID);
    
    let isAdmin = false, userRole = 'investor', currentCat = 'Ø§Ù„ÙƒÙ„', tempImgs = [];
    let botMemory = JSON.parse(localStorage.getItem('botMemory')) || {"Ø³Ù„Ø§Ù…": "ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù…! ÙƒÙŠÙ Ø£Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§ØªØŸ", "Ø´ÙƒØ±Ø§": "Ø§Ù„Ø¹ÙÙˆØŒ Ø£Ù†Ø§ ÙÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©!"};

    function toggleChat(){ const chat = document.getElementById('botChat'); chat.style.display = (chat.style.display === 'flex' ? 'none' : 'flex'); }

    function sendBotMsg() {
        const input = document.getElementById('botInput');
        const val = input.value.trim();
        if(!val) return;
        addMsg(val, 'user');
        input.value = '';

        setTimeout(() => {
            let reply = "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£ÙÙ‡Ù…Ùƒ Ø¬ÙŠØ¯Ø§Ù‹. Ù‡Ù„ ØªØ¨Ø­Ø« Ø¹Ù† Ø´Ù‚Ø© Ø£Ùˆ ÙÙŠÙ„Ø§ØŸ";
            const lowVal = val.toLowerCase();

            // Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¨Ø­Ø«: Ø¥Ø°Ø§ Ø·Ù„Ø¨ Ø¹Ù‚Ø§Ø±
            if(lowVal.includes("Ø´Ù‚Ø©") || lowVal.includes("ÙÙŠÙ„Ø§") || lowVal.includes("Ù…Ù†Ø²Ù„") || lowVal.includes("Ù…Ø³Ø¨Ø­")){
                reply = "Ø¨Ø§Ù„ØªØ£ÙƒÙŠØ¯! Ø³Ø£Ø¨Ø­Ø« Ù„Ùƒ Ø¹Ù† Ø£ÙØ¶Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬...";
                findPostsForBot(lowVal);
            } else if(botMemory[lowVal]){
                reply = botMemory[lowVal];
            } else {
                // ØªØ¹Ù„Ù… Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                botMemory[lowVal] = "Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ„Ù…Ø©! Ø³Ø£Ø­Ø§ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹.";
                localStorage.setItem('botMemory', JSON.stringify(botMemory));
            }
            addMsg(reply, 'bot');
        }, 1000);
    }

    function addMsg(txt, sender){
        const box = document.getElementById('chatBox');
        box.innerHTML += `<div class="msg ${sender}-msg">${txt}</div>`;
        box.scrollTop = box.scrollHeight;
    }

    function findPostsForBot(q) {
        db.collection("posts").get().then(snap => {
            let count = 0;
            snap.forEach(doc => {
                const d = doc.data();
                if(`${d.title} ${d.desc} ${d.extras}`.toLowerCase().includes(q) && count < 2){
                    addMsg(`ÙˆØ¬Ø¯Ù†Ø§ Ù„Ùƒ: ${d.title} Ø¨Ø³Ø¹Ø± ${d.price} DH. Ø§Ù„Ù…Ø±Ø¬Ø¹: ${d.ref}`, 'bot');
                    count++;
                }
            });
            if(count === 0) addMsg("Ù„Ù„Ø£Ø³Ù Ù„Ù… Ø£Ø¬Ø¯ Ø·Ù„Ø¨Ùƒ Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ Ø¬Ø±Ø¨ Ù…ÙˆØ§ØµÙØ§Øª Ø£Ø®Ø±Ù‰.", 'bot');
        });
    }

    // Ø¨Ù‚ÙŠØ© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    function setRole(r){ userRole=r; document.getElementById('startScreen').style.display='none'; document.getElementById('mainApp').style.display='block'; listenToPosts(); }
    function toggleMenu(){ document.getElementById('sideMenu').classList.toggle('active'); }
    function toggleTheme(){ document.body.classList.toggle('light-mode'); }

    function listenToPosts() {
        const feed = document.getElementById('feed'), q = document.getElementById('searchInput').value.trim().toLowerCase();
        if(q === '3505ilyas2008@') { isAdmin=true; alert("Ø§Ù„Ø£Ø¯Ù…Ù† Ù†Ø´Ø·"); document.getElementById('searchInput').value=""; return; }
        db.collection("posts").orderBy("time", "desc").onSnapshot(snap => {
            feed.innerHTML = "";
            snap.forEach(doc => {
                const data = doc.data();
                if((currentCat !== 'Ø§Ù„ÙƒÙ„' && data.type !== currentCat) || (q && !`${data.title} ${data.desc} ${data.ref}`.toLowerCase().includes(q))) return;
                feed.innerHTML += `<div class="post-card">
                    <span class="price-tag">${data.price} DH</span>
                    <div style="display:flex;overflow-x:auto;gap:5px;">${data.imgs.map(i=>`<img src="${i}" style="height:150px;border-radius:10px;">`).join('')}</div>
                    <h3>${data.title}</h3><p>${data.desc}</p>
                    <span class="ref-tag">ID: ${data.ref}</span>
                    <div style="display:flex;gap:10px;"><a href="tel:${data.phone}" class="btn">Ø§ØªØµØ§Ù„</a>
                    ${userRole==='investor' ? `<button class="btn" style="background:#007bff;" onclick="showROI(${data.price},'${data.type}')">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø¨Ø­</button>` : ''}</div>
                    ${(isAdmin || data.userId===myID) ? `<button onclick="deletePost('${doc.id}')" style="background:red;border:none;color:white;width:100%;padding:5px;border-radius:5px;margin-top:5px;">Ø­Ø°Ù</button>` : ''}
                </div>`;
            });
        });
    }

    function showROI(p,t){ document.getElementById('invD').innerHTML=`Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: ${(p*(t==='ÙÙŠÙ„Ø§Øª'?0.1:0.08)).toFixed(0)} DH`; document.getElementById('investModal').style.display='flex'; }
    async function handleFiles(fs){ for(let f of fs){ const r=new FileReader(); r.readAsDataURL(f); r.onload=(e)=>{ tempImgs.push(e.target.result); document.getElementById('preGrid').innerHTML+=`<img src="${e.target.result}" style="width:50px;height:50px;">`;}} }
    function uploadPost(){
        const ref="D"+Math.floor(Math.random()*9000+1000);
        db.collection("posts").add({ title:document.getElementById('pTitle').value, price:document.getElementById('pPrice').value, desc:document.getElementById('pDesc').value, extras:document.getElementById('pExtras').value, type:document.getElementById('pType').value, phone:document.getElementById('pPhone').value, imgs:tempImgs, userId:myID, time:Date.now(), ref:ref }).then(()=>location.reload());
    }
    function deletePost(id){ if(confirm("Ø­Ø°ÙØŸ")) db.collection("posts").doc(id).delete(); }
    function setCat(c,b){ currentCat=c; document.querySelectorAll('.cat-btn').forEach(x=>x.classList.remove('active')); b.classList.add('active'); listenToPosts(); }
    function showPremium(){ alert("ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªÙ…ÙŠØ±: 212695067840"); }
</script>
</body>
</html>
