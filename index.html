<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Diablo Hub | Morocco</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <style>
        :root{--p:#ff4500;--bg:#050505;--card:#111;--t:#fff;--border:#222;--gold:#ffd700;}
        .light-mode{--bg:#f5f5f5;--card:#fff;--t:#222;--border:#ddd;}
        body{background:var(--bg);color:var(--t);font-family:'Cairo',sans-serif;margin:0;padding-bottom:100px;overflow-x:hidden;}
        #startScreen{display:flex;position:fixed;inset:0;background:var(--bg);z-index:9999;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:20px;}
        #mainApp{display:none;}
        header{padding:15px 5%;display:flex;justify-content:space-between;align-items:center;background:var(--card);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:1000;}
        .side-menu{position:fixed;top:0;right:-100%;width:280px;height:100%;background:var(--card);z-index:9500;transition:0.4s;padding:20px;box-sizing:border-box;border-left:1px solid var(--border);overflow-y:auto;}
        .side-menu.active{right:0;}
        .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:none;z-index:9400;}
        .categories{display:flex;overflow-x:auto;gap:10px;padding:10px 5%;white-space:nowrap;}
        .cat-btn{background:var(--card);border:1px solid var(--border);color:var(--t);padding:8px 15px;border-radius:20px;cursor:pointer;}
        .cat-btn.active{background:var(--p);color:white;border-color:var(--p);}
        .post-card{background:var(--card);border:1px solid var(--border);border-radius:15px;margin:15px 5%;padding:15px;position:relative;}
        .request-card{background:linear-gradient(45deg, #1a1a1a, #222); border:1px dashed var(--p); border-radius:15px; margin:15px 5%; padding:15px;}
        .price-tag{position:absolute;top:10px;left:10px;background:#25d366;color:white;padding:3px 12px;border-radius:20px;font-weight:bold;}
        .btn{background:var(--p);color:white;border:none;padding:12px;border-radius:8px;cursor:pointer;font-weight:bold;width:100%;margin-top:10px;text-align:center;text-decoration:none;display:block;}
        #publishModal, #premiumPage, #requestModal, #policyModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:10001;align-items:center;justify-content:center;padding:20px;}
        .modal-content{background:var(--card);padding:20px;border-radius:15px;max-width:500px;width:100%;max-height:90vh;overflow-y:auto;}
        input,textarea,select{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:1px solid var(--border);background:var(--bg);color:var(--t);box-sizing:border-box;}
        .loading-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.9);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:20000;color:white;}
        .publish-btn-main{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);width:60px;height:60px;background:var(--p);border-radius:50%;display:none;align-items:center;justify-content:center;z-index:9000;border:none;color:white;font-size:30px;box-shadow:0 4px 15px rgba(255,69,0,0.4);}
        .whatsapp-btn{background:#25d366; color:white; border-radius:50%; width:60px; height:60px; display:flex; align-items:center; justify-content:center; font-size:30px; margin:20px auto; text-decoration:none;}
    </style>
</head>
<body>

<div id="loading" class="loading-overlay"><i class="fas fa-spinner fa-spin" style="font-size:40px;color:var(--p)"></i><p id="loadText">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</p></div>

<div id="startScreen">
    <h1 style="color:var(--p);font-size:40px;">DIABLO HUB</h1>
    <p>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø£Ù‚ÙˆÙ‰ Ù…Ù†ØµØ© Ø¹Ù‚Ø§Ø±ÙŠØ© ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨</p>
    <div style="width:100%;max-width:300px;margin-top:20px;">
        <button class="btn" onclick="setRole('investor')">ØªØµÙØ­ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</button>
        <button class="btn" style="background:#222;border:1px solid var(--p);" onclick="setRole('seller')">Ø£Ø±ÙŠØ¯ Ø§Ù„Ù†Ø´Ø± (Ù…Ø§Ù„Ùƒ)</button>
    </div>
</div>

<div id="mainApp">
    <header>
        <button onclick="toggleMenu()" style="background:none;border:none;color:var(--p);font-size:24px;">â˜°</button>
        <strong style="color:var(--p)">DIABLO HUB</strong>
        <button onclick="toggleTheme()" style="background:none;border:none;color:var(--p);font-size:20px;"><i class="fas fa-moon" id="themeIcon"></i></button>
    </header>

    <div class="categories">
        <button class="cat-btn active" onclick="setCat('Ø§Ù„ÙƒÙ„', this)">Ø§Ù„ÙƒÙ„</button>
        <button class="cat-btn" onclick="setCat('Ø´Ù‚Ù‚', this)">ğŸ™ï¸ Ø´Ù‚Ù‚</button>
        <button class="cat-btn" onclick="setCat('ÙÙŠÙ„Ø§Øª', this)">ğŸ° ÙÙŠÙ„Ø§Øª</button>
        <button class="cat-btn" onclick="setCat('Ù…Ù†Ø§Ø²Ù„', this)">ğŸ¡ Ù…Ù†Ø§Ø²Ù„</button>
        <button class="cat-btn" id="reqCatBtn" onclick="setCat('Ø·Ù„Ø¨Ø§Øª', this)">ğŸ“‹ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨Ø­Ø«</button>
        <button class="cat-btn" style="background:var(--gold);color:black;font-weight:bold;" onclick="showPremium()">âœ¨ ØªÙ…ÙŠØ² Ø§Ù„Ø¢Ù†</button>
    </div>

    <div id="feed"></div>
    <button class="publish-btn-main" id="mainPubBtn" onclick="document.getElementById('publishModal').style.display='flex'">+</button>
</div>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>
<div class="side-menu" id="sideMenu">
    <h2 style="color:var(--p)">DIABLO HUB</h2>
    <hr style="border:0;border-top:1px solid var(--border);margin:10px 0;">
    <button class="btn" onclick="location.reload()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button class="btn" style="background:#222;" onclick="openRequestModal()">â• Ø§Ù†Ø´Ø± Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡</button>
    <button class="btn" onclick="showPremium()">ğŸ’ Ø¥Ø¹Ù„Ø§Ù† Ù…Ù…ÙŠØ²</button>
    <button class="btn" onclick="toggleTheme()">ğŸŒ“ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¸Ù‡Ø±</button>
    <hr style="border:0;border-top:1px solid var(--border);margin:20px 0;">
    <button class="btn" style="background:none; color:var(--t); font-size:14px;" onclick="showPolicy('terms')">ğŸ“œ Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</button>
    <button class="btn" style="background:none; color:var(--t); font-size:14px;" onclick="showPolicy('privacy')">ğŸ”’ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</button>
    <button class="btn" style="background:none; color:var(--t); font-size:14px;" onclick="showPolicy('disclaimer')">âš ï¸ Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©</button>
</div>

<div id="policyModal">
    <div class="modal-content">
        <h3 id="policyTitle" style="color:var(--p)"></h3>
        <div id="policyBody" style="font-size:14px; line-height:1.6;"></div>
        <button class="btn" onclick="document.getElementById('policyModal').style.display='none'">ÙÙ‡Ù…Øª Ø°Ù„Ùƒ</button>
    </div>
</div>

<div id="publishModal">
    <div class="modal-content">
        <h3 style="color:var(--p)">Ù†Ø´Ø± Ø¹Ù‚Ø§Ø± Ø¬Ø¯ÙŠØ¯</h3>
        <select id="pType"><option value="Ø´Ù‚Ù‚">Ø´Ù‚Ø©</option><option value="ÙÙŠÙ„Ø§Øª">ÙÙŠÙ„Ø§</option><option value="Ù…Ù†Ø§Ø²Ù„">Ù…Ù†Ø²Ù„</option></select>
        <input type="text" id="pTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù‚Ø§Ø± (Ù…Ø«Ø§Ù„: Ø´Ù‚Ø© ÙÙŠ Ø·Ù†Ø¬Ø©)">
        <input type="number" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¯Ø±Ù‡Ù… (DH)">
        <textarea id="pDesc" rows="4" placeholder="Ø§Ù„ØªÙØ§ØµÙŠÙ„..."></textarea>
        <input type="tel" id="pPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù„ØªÙˆØ§ØµÙ„">
        <input type="file" id="pFiles" multiple accept="image/*" onchange="handleFiles(this.files)">
        <div id="preGrid" style="display:flex;gap:10px;margin:10px 0;overflow-x:auto;"></div>
        <button class="btn" onclick="uploadPost()">Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø¢Ù†</button>
        <button class="btn" style="background:#111;" onclick="document.getElementById('publishModal').style.display='none'">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<div id="requestModal">
    <div class="modal-content">
        <h3 style="color:var(--p)">Ù…Ø§Ø°Ø§ ØªØ¨Ø­Ø« Ø¹Ù†Ù‡ØŸ âœ¨</h3>
        <input type="text" id="rCity" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©">
        <input type="number" id="rPrice" placeholder="Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©">
        <select id="rType"><option value="Ø´Ù‚Ù‚">Ø´Ù‚Ø©</option><option value="ÙÙŠÙ„Ø§Øª">ÙÙŠÙ„Ø§</option><option value="Ù…Ù†Ø§Ø²Ù„">Ù…Ù†Ø²Ù„</option></select>
        <input type="tel" id="rPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
        <button class="btn" onclick="addRequest()">ØªØ£ÙƒÙŠØ¯ ÙˆÙ†Ø´Ø± Ø§Ù„Ø·Ù„Ø¨</button>
        <button class="btn" style="background:#111;" onclick="document.getElementById('requestModal').style.display='none'">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<div id="premiumPage">
    <div class="modal-content" style="text-align:center;">
        <h2 style="color:var(--gold)">ØªÙ…ÙŠØ² Ø§Ù„Ø¢Ù† âœ¨</h2>
        <p>Ø§Ø¬Ø¹Ù„ Ø¥Ø¹Ù„Ø§Ù†Ùƒ ÙÙŠ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¨Ù„ÙˆÙ† Ø¬Ø°Ø§Ø¨.</p>
        <p style="font-weight:bold; color:var(--p);">Ø³Ø¹Ø± Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø§Ù„Ù…Ù…ÙŠØ²: 1$</p>
        <p>Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ…ÙŠØ²ØŒ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨:</p>
        <a href="https://wa.me/212695067840" target="_blank" class="whatsapp-btn"><i class="fab fa-whatsapp"></i></a>
        <button class="btn" onclick="document.getElementById('premiumPage').style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCGWNteBBsejx6UISfvnTY1YmnQeom7vNg",
        authDomain: "daiblosmart.firebaseapp.com",
        projectId: "daiblosmart",
        storageBucket: "daiblosmart.appspot.com"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    if(!localStorage.getItem('myDiabloID')){
        localStorage.setItem('myDiabloID', 'user_' + Math.random().toString(36).substr(2, 9));
    }
    const myID = localStorage.getItem('myDiabloID');
    let tempImgs = [], currentCat = 'Ø§Ù„ÙƒÙ„';

    function setRole(role) {
        document.getElementById('startScreen').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        if(role === 'seller') document.getElementById('mainPubBtn').style.display = 'flex';
        listenToPosts();
    }

    function toggleMenu() {
        document.getElementById('sideMenu').classList.toggle('active');
        document.getElementById('overlay').style.display = document.getElementById('sideMenu').classList.contains('active') ? 'block' : 'none';
    }

    function toggleTheme() {
        document.body.classList.toggle('light-mode');
        document.getElementById('themeIcon').className = document.body.classList.contains('light-mode') ? 'fas fa-sun' : 'fas fa-moon';
    }

    async function handleFiles(files) {
        for(let f of files) {
            const reader = new FileReader();
            reader.readAsDataURL(f);
            reader.onload = (e) => {
                const img = new Image();
                img.src = e.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 500; canvas.height = (img.height / img.width) * 500;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    const compressed = canvas.toDataURL('image/jpeg', 0.6);
                    tempImgs.push(compressed);
                    document.getElementById('preGrid').innerHTML += `<img src="${compressed}" style="width:60px;height:60px;border-radius:5px;object-fit:cover;">`;
                };
            };
        }
    }

    function uploadPost() {
        const t = document.getElementById('pTitle').value, p = document.getElementById('pPrice').value;
        if(!t || !p || tempImgs.length === 0) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØµÙˆØ±");
        document.getElementById('loadText').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...";
        document.getElementById('loading').style.display = 'flex';
        db.collection("posts").add({
            title: t, price: p, desc: document.getElementById('pDesc').value,
            type: document.getElementById('pType').value, phone: document.getElementById('pPhone').value,
            imgs: tempImgs, userId: myID, time: Date.now()
        }).then(() => location.reload());
    }

    function addRequest() {
        const city = document.getElementById('rCity').value, price = document.getElementById('rPrice').value, phone = document.getElementById('rPhone').value;
        if(!city || !price || !phone) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        
        document.getElementById('loadText').innerText = "Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ...";
        document.getElementById('loading').style.display = 'flex';

        // Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨: Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø¯Ù‚Ø©
        db.collection("requests").add({
            city: city,
            price: price,
            phone: phone,
            type: document.getElementById('rType').value,
            userId: myID,
            time: Date.now()
        }).then(() => { 
            document.getElementById('loading').style.display = 'none';
            document.getElementById('requestModal').style.display = 'none';
            alert("ØªÙ… Ù†Ø´Ø± Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!"); 
            // Ø§Ù„ØªÙˆØ¬Ù‡ ÙÙˆØ±Ø§ Ù„Ù‚Ø³Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù†ØªÙŠØ¬Ø©
            setCat('Ø·Ù„Ø¨Ø§Øª', document.getElementById('reqCatBtn'));
        }).catch((err) => {
            document.getElementById('loading').style.display = 'none';
            console.error("Error: ", err);
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
        });
    }

    function listenToPosts() {
        const feed = document.getElementById('feed');
        if(currentCat === 'Ø·Ù„Ø¨Ø§Øª') {
            db.collection("requests").orderBy("time", "desc").onSnapshot(snap => {
                feed.innerHTML = "<h2 style='padding:0 5%'>ğŸ“‹ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨Ø­Ø«</h2>";
                snap.forEach(doc => {
                    const r = doc.data();
                    let del = (r.userId === myID) ? `<button onclick="deleteReq('${doc.id}')" style="background:red;border:none;color:white;padding:3px;border-radius:5px;cursor:pointer;">Ø­Ø°Ù</button>` : "";
                    feed.innerHTML += `<div class="request-card">
                        <h4 style="color:var(--p);margin:0;">ğŸš© Ù…Ø·Ù„ÙˆØ¨ ${r.type} ÙÙŠ ${r.city}</h4>
                        <p>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©: ${r.price} DH | Ù‡Ø§ØªÙ: ${r.phone}</p>
                        <div style="display:flex;gap:10px;"><a href="tel:${r.phone}" class="btn" style="padding:5px;font-size:12px;">ğŸ“ Ø§ØªØµØ§Ù„</a>${del}</div>
                    </div>`;
                });
            });
        } else {
            db.collection("posts").orderBy("time", "desc").onSnapshot(snap => {
                feed.innerHTML = "";
                snap.forEach(doc => {
                    const data = doc.data();
                    if(currentCat !== 'Ø§Ù„ÙƒÙ„' && data.type !== currentCat) return;
                    let del = (data.userId === myID) ? `<button onclick="deletePost('${doc.id}')" style="background:red;border:none;color:white;padding:5px;border-radius:5px;cursor:pointer;">Ø­Ø°Ù</button>` : "";
                    feed.innerHTML += `<div class="post-card">
                        <span class="price-tag">${data.price} DH</span>
                        <div style="display:flex;overflow-x:auto;gap:10px;margin-bottom:10px;">${data.imgs.map(img => `<img src="${img}" style="height:150px;border-radius:10px;min-width:200px;object-fit:cover;">`).join('')}</div>
                        <h3>${data.title}</h3><p style="font-size:14px;opacity:0.8">${data.desc}</p>
                        <div style="display:flex;gap:10px;"><a href="tel:${data.phone}" class="btn" style="flex:1">Ø§ØªØµØ§Ù„</a>${del}</div>
                    </div>`;
                });
            });
        }
    }

    function deletePost(id) { if(confirm("Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ")) db.collection("posts").doc(id).delete(); }
    function deleteReq(id) { if(confirm("Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ØŸ")) db.collection("requests").doc(id).delete(); }
    function setCat(cat, btn) {
        currentCat = cat;
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        listenToPosts();
    }
    function showPremium() { document.getElementById('premiumPage').style.display = 'flex'; }
    function openRequestModal() { document.getElementById('requestModal').style.display = 'flex'; }
    function showPolicy(type) {
        const title = document.getElementById('policyTitle'), body = document.getElementById('policyBody');
        if(type === 'terms') { title.innerText = "Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…"; body.innerHTML = "â€¢ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©.<br>â€¢ Ù„Ø§ Ù…Ø­ØªÙˆÙ‰ Ù…Ø®Ø§Ù„Ù."; }
        else if(type === 'privacy') { title.innerText = "Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©"; body.innerHTML = "â€¢ Ù†Ø­ÙØ¸ Ø§Ù„Ù‡ÙˆÙŠØ© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙƒ."; }
        else { title.innerText = "Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©"; body.innerHTML = "â€¢ Ù†Ø­Ù† ÙˆØ³ÙŠØ· ÙˆÙ„Ø³Ù†Ø§ Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª."; }
        document.getElementById('policyModal').style.display = 'flex';
        toggleMenu();
    }
</script>
</body>
            </html>
    
