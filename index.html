<!DOCTYPE html>
<html lang="ar" dir="rtl" id="diablo-app">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Diablo Hub | Admin & Security</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>

    <style>
        :root { --p: #ff4500; --bg: #050505; --card: #111; --t: #fff; --border: #222; --bot-bg: #444; }
        .light-mode { --bg: #f5f5f5; --card: #fff; --t: #222; --border: #ddd; --bot-bg: #eee; }
        body { background: var(--bg); color: var(--t); font-family: 'Cairo', sans-serif; margin: 0; transition: 0.3s; overflow-x: hidden; width: 100vw; }
        header { padding: 10px 5%; display: flex; justify-content: space-between; align-items: center; background: var(--card); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 1000; width: 100%; box-sizing: border-box; }
        .nav-btns { display: flex; gap: 8px; }
        .icon-btn { background: none; border: 1px solid var(--border); color: var(--t); padding: 5px 10px; border-radius: 8px; cursor: pointer; }
        .side-menu { position: fixed; top: 0; right: -100%; width: 280px; height: 100%; background: var(--card); z-index: 3000; transition: 0.4s; padding: 20px; border-left: 1px solid var(--border); }
        .side-menu.active { right: 0; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; z-index: 2500; backdrop-filter: blur(5px); }
        .page-content { padding: 15px 5%; width: 100%; box-sizing: border-box; display: none; }
        .post-card { background: var(--card); border: 1px solid var(--border); border-radius: 15px; margin-bottom: 20px; padding: 15px; position: relative; }
        .img-slider { display: flex; overflow-x: auto; gap: 10px; }
        .img-slider img { height: 160px; border-radius: 10px; flex-shrink: 0; }
        .btn { background: var(--p); color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 5px; }
        input, textarea { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--t); box-sizing: border-box; }
        .admin-del-btn { position: absolute; top: 10px; right: 50px; background: #ff0000; color: white; border: none; border-radius: 5px; padding: 5px 10px; font-size: 12px; cursor: pointer; display: none; z-index: 20; }
    </style>
</head>
<body>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<div class="side-menu" id="sideMenu">
    <h2 style="color:var(--p)">DIABLO HUB</h2>
    <a href="#" style="display:block; color:var(--t); padding:10px 0; text-decoration:none;" onclick="showPage('home')">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="#" style="display:block; color:var(--t); padding:10px 0; text-decoration:none;" onclick="showPage('favs')">â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù„Ø©</a>
    <a href="#" style="display:block; color:var(--t); padding:10px 0; text-decoration:none;" onclick="showPage('auth')">ğŸ‘¤ Ø­Ø³Ø§Ø¨ÙŠ</a>
    <button class="btn" style="margin-top: 20px; background: #333;" onclick="toggleMenu()">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<header>
    <div style="display:flex; align-items:center; gap:8px;">
        <button onclick="toggleMenu()" style="background:none; border:none; color:var(--p); font-size:24px;">â˜°</button>
        <div style="font-weight:bold; color:var(--p);">DIABLO HUB</div>
    </div>
    <div class="nav-btns">
        <button class="icon-btn" onclick="toggleTheme()" id="themeBtn">ğŸŒ™</button>
        <button class="icon-btn" style="border-color:var(--p)" onclick="showPage('auth')" id="userBtn">ğŸ‘¤</button>
    </div>
</header>

<div id="authPage" class="page-content">
    <div id="loginForm" style="text-align:center; max-width:350px; margin:auto;">
        <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
        <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn" onclick="handleAuth()">Ø¯Ø®ÙˆÙ„</button>
        <p style="font-size:11px; margin-top:10px; opacity:0.6;">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¯Ù…Ù† Ù…Ø­Ù…ÙŠ Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª.</p>
    </div>
    <div id="userInfo" style="display:none; text-align:center;">
        <h3 id="welcomeMsg">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¯ÙŠØ§Ø¨Ù„Ùˆ</h3>
        <button class="btn" onclick="logout()" style="background:#444;">Ø®Ø±ÙˆØ¬</button>
    </div>
</div>

<div id="homePage" class="page-content" style="display:block;">
    <div id="roleSelection" style="text-align:center; padding: 20px 0;">
        <button class="btn" onclick="initApp('investor')" style="max-width:200px;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±ÙŠÙ†</button>
        <button class="btn" onclick="initApp('seller')" style="max-width:200px; margin-top:8px; background:#222; border:1px solid var(--p);">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù„Ø§Ùƒ</button>
    </div>

    <div id="uploadArea" style="display:none; background:var(--card); padding:15px; border-radius:15px; border:1px solid var(--border); margin-bottom:20px;">
        <h4 style="margin:0 0 10px 0;">Ù†Ø´Ø± Ø¹Ø±Ø¶ Ø¬Ø¯ÙŠØ¯ (Ù…Ø±Ø§Ù‚Ø¨ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹)</h4>
        <input type="text" id="pTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù‚Ø§Ø±...">
        <textarea id="pDesc" rows="2" placeholder="Ø§Ù„ÙˆØµÙ ÙˆØ§Ù„Ø³Ø¹Ø±..."></textarea>
        <input type="file" id="pFiles" multiple accept="image/*" onchange="handleFiles(this.files)">
        <div id="preGrid" style="display:flex; gap:8px; overflow-x:auto; margin:5px 0;"></div>
        <button class="btn" onclick="uploadToFirebase()">Ù†Ø´Ø± Ø§Ù„Ø¢Ù†</button>
    </div>
    <div id="cloudFeed"></div>
</div>

<div id="favsPage" class="page-content">
    <h2 style="color:var(--p)">â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù„Ø©</h2>
    <div id="favFeed"></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCGWNteBBsejx6UISfvnTY1YmnQeom7vNg",
        authDomain: "daiblosmart.firebaseapp.com",
        projectId: "daiblosmart",
        storageBucket: "daiblosmart.firebasestorage.app",
        messagingSenderId: "948075676362",
        appId: "1:948075676362:web:c27d582068712cbe13aa33"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    
    let tempImgs = [], userRole = '', isAdmin = false, allPosts = [];
    let favorites = JSON.parse(localStorage.getItem('diablo_favs') || '[]');

    // ÙÙ„ØªØ± Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¨Ø°ÙŠØ¦Ø© ÙˆØ§Ù„Ø¥Ø¨Ø§Ø­ÙŠØ© (Ù‚Ø§Ø¦Ù…Ø© Ù…ØµØºØ±Ø© ÙƒÙ…Ø«Ø§Ù„)
    const badWords = ["Ø³ÙƒØ³", "Ø§Ø¨Ø§Ø­ÙŠ", "sex", "porn", "nude", "Ø¹Ø§Ø±ÙŠ"]; 

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('userInfo').style.display = 'block';
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ Ø£Ù†Øª (Ø§Ù„Ø£Ø¯Ù…Ù†)
            if(user.email === "diablo@admin.com") {
                isAdmin = true;
                document.getElementById('welcomeMsg').innerText = "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ø¯ÙŠØ± (Diablo)";
            }
            renderPosts(allPosts, 'cloudFeed');
        } else {
            isAdmin = false;
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('userInfo').style.display = 'none';
        }
    });

    function handleAuth() {
        const e = document.getElementById('email').value;
        const p = document.getElementById('pass').value;
        auth.signInWithEmailAndPassword(e, p).catch(() => {
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ØŒ Ø³ÙŠÙ‚ÙˆÙ… Ø¨Ø¥Ù†Ø´Ø§Ø¦Ù‡ (Ù„Ø£ÙˆÙ„ Ù…Ø±Ø© ÙÙ‚Ø·)
            auth.createUserWithEmailAndPassword(e, p).catch(err => alert(err.message));
        });
    }

    function logout() { auth.signOut().then(() => location.reload()); }

    function uploadToFirebase() {
        const title = document.getElementById('pTitle').value;
        const desc = document.getElementById('pDesc').value;

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ©: ÙØ­Øµ Ø§Ù„Ù†ØµÙˆØµ
        const combinedText = (title + " " + desc).toLowerCase();
        const containsBadContent = badWords.some(word => combinedText.includes(word));

        if(containsBadContent) {
            alert("âš ï¸ Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø§Ù„Ù…Ù†Ø´ÙˆØ± ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª Ù…Ø®Ø§Ù„ÙØ© Ù„Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹.");
            return;
        }

        if(!title || tempImgs.length === 0) return alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©");
        
        db.collection("diablo_posts").add({
            title, desc, imgs: tempImgs.map(i => i.src), time: Date.now(),
            owner: auth.currentUser ? auth.currentUser.email : "guest"
        }).then(() => location.reload());
    }

    function loadCloudData() {
        db.collection("diablo_posts").orderBy("time", "desc").onSnapshot(snap => {
            allPosts = [];
            snap.forEach(doc => {
                let data = doc.data();
                data.docId = doc.id; // Ø­ÙØ¸ ID Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ù„Ù„Ø­Ø°Ù
                allPosts.push(data);
            });
            renderPosts(allPosts, 'cloudFeed');
        });
    }

    function renderPosts(posts, target) {
        document.getElementById(target).innerHTML = posts.map(p => `
            <div class="post-card">
                <button class="admin-del-btn" style="display:${isAdmin?'block':'none'}" onclick="deletePost('${p.docId}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                <button class="fav-btn" onclick="toggleFavorite('${p.docId}')" style="background:none; border:none; color:${favorites.includes(p.docId)?'red':'#ccc'}; position:absolute; top:10px; left:10px; font-size:20px; cursor:pointer;">â¤ï¸</button>
                <div class="img-slider">${p.imgs.map(i => `<img src="${i}">`).join('')}</div>
                <h3>${p.title}</h3>
                <p style="font-size:13px; opacity:0.8;">${p.desc}</p>
            </div>
        `).join('');
    }

    function deletePost(id) {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
            db.collection("diablo_posts").doc(id).delete();
        }
    }

    // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ (Search, Theme, Menu)
    function initApp(role) {
        userRole = role;
        document.getElementById('roleSelection').style.display = 'none';
        if(role === 'seller') document.getElementById('uploadArea').style.display = 'block';
        loadCloudData();
    }

    function handleFiles(files) {
        Array.from(files).forEach(f => {
            const r = new FileReader();
            r.onload = e => {
                tempImgs.push({src: e.target.result, id: Date.now()});
                renderPreviews();
            };
            r.readAsDataURL(f);
        });
    }

    function renderPreviews() {
        document.getElementById('preGrid').innerHTML = tempImgs.map(img => `<img src="${img.src}" style="height:50px; border-radius:5px;">`).join('');
    }

    function showPage(p) {
        document.querySelectorAll('.page-content').forEach(c => c.style.display='none');
        document.getElementById(p+'Page').style.display='block';
        toggleMenu();
    }

    function toggleMenu() {
        const m = document.getElementById('sideMenu');
        m.classList.toggle('active');
        document.getElementById('overlay').style.display = m.classList.contains('active') ? 'block' : 'none';
    }

    function toggleTheme() {
        document.body.classList.toggle('light-mode');
    }
</script>
</body>
    </html>
    
