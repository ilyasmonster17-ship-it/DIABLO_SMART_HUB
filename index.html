<!DOCTYPE html>
<html lang="ar" dir="rtl" id="diablo-app">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Diablo Hub | New Generation</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>

<style>
:root { --p: #ff4500; --bg: #050505; --card: #111; --t: #fff; --border: #222; --gold: #ffd700; }
.light-mode { --bg: #f5f5f5; --card: #fff; --t: #222; --border: #ddd; }
body { background: var(--bg); color: var(--t); font-family: 'Cairo', sans-serif; margin: 0; padding-bottom: 100px; overflow-x: hidden; }

#startScreen { display:flex; position:fixed; inset:0; background:var(--bg); z-index:9999; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:20px; }
#mainApp { display:none; }

header { padding:15px 5%; display:flex; justify-content:space-between; align-items:center; background:var(--card); border-bottom:1px solid var(--border); position:sticky; top:0; z-index:1000; }
.search-bar { flex:1; display:flex; background:var(--bg); border:1px solid var(--border); border-radius:20px; padding:5px 15px; margin:0 10px; }
.search-bar input { border:none; background:none; color:var(--t); outline:none; width:100%; font-size:14px; }

.categories { display:flex; overflow-x:auto; gap:10px; padding:10px 5%; white-space:nowrap; }
.cat-btn { background:var(--card); border:1px solid var(--border); color:var(--t); padding:8px 15px; border-radius:20px; cursor:pointer; }
.cat-btn.active { background:var(--p); border-color:var(--p); color:white; }

.publish-btn-main { position:fixed; bottom:30px; left:50%; transform:translateX(-50%); width:50px; height:40px; background:linear-gradient(90deg, #00f2ea 0%, #ff0050 100%); border-radius:12px; display:none; align-items:center; justify-content:center; z-index:9000; cursor:pointer; border:none; }
.publish-btn-main::after { content:'+'; color:black; font-size:25px; font-weight:bold; background:white; width:25px; height:25px; border-radius:5px; display:flex; align-items:center; justify-content:center; }

.post-card { background:var(--card); border:1px solid var(--border); border-radius:15px; margin:15px 5%; padding:15px; position:relative; }
.post-card.premium { border:2px solid var(--gold); box-shadow:0 0 15px rgba(255, 215, 0, 0.2); }
.price-tag { position:absolute; top:10px; left:10px; background:#25d366; color:white; padding:3px 12px; border-radius:20px; font-weight:bold; }

.side-menu { position:fixed; top:0; right:-100%; width:280px; height:100%; background:var(--card); z-index:9500; transition:0.4s; padding:20px; box-sizing:border-box; }
.side-menu.active { right:0; }
.overlay { position:fixed; inset:0; background:rgba(0,0,0,0.8); display:none; z-index:9400; }

.btn { background:var(--p); color:white; border:none; padding:12px; border-radius:8px; cursor:pointer; font-weight:bold; width:100%; margin-top:10px; text-align:center; text-decoration:none; display:block; }
input, textarea, select { width:100%; padding:12px; margin:8px 0; border-radius:8px; border:1px solid var(--border); background:var(--bg); color:var(--t); box-sizing:border-box; }

#bot-chat-window { position:fixed; bottom:90px; left:20px; width:300px; height:400px; background:var(--card); border:1px solid var(--p); border-radius:15px; display:none; flex-direction:column; z-index:9999; }
.chat-area { flex:1; padding:10px; overflow-y:auto; display:flex; flex-direction:column; gap:8px; }
.msg { padding:8px 12px; border-radius:10px; max-width:80%; font-size:13px; }
.msg.bot { background:#222; align-self:flex-start; }
.msg.user { background:var(--p); align-self:flex-end; }

#premiumPage { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:10001; align-items:center; justify-content:center; padding:20px; overflow-y:auto; }
#premiumPage .content { background:var(--card); padding:20px; border-radius:15px; max-width:500px; width:100%; }

#citySelector { display:flex; flex-direction:column; max-height:200px; overflow-y:auto; border:1px solid var(--border); border-radius:8px; background:var(--card); padding:5px; position:absolute; z-index:9999; width:100%; }
#citySelector input { margin-bottom:5px; }
#citySelector div { padding:5px; cursor:pointer; border-radius:5px; }
#citySelector div:hover { background:var(--p); color:#fff; }
</style>
</head>
<body>

<div id="startScreen">
<h1 style="color:var(--p); margin-bottom:5px;">DIABLO HUB</h1>
<p style="font-size:14px; opacity:0.8;">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø£Ù‚ÙˆÙ‰ Ù…Ù†ØµØ© Ø¹Ù‚Ø§Ø±ÙŠØ©</p>
<div style="width:100%; max-width:300px; margin-top:20px;">
<button class="btn" onclick="setRole('investor')">Ø£Ù†Ø§ Ù…Ø³ØªØ«Ù…Ø± (ØªØµÙØ­ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª)</button>
<button class="btn" style="background:#222; border:1px solid var(--p);" onclick="setRole('seller')">Ø£Ù†Ø§ Ù…Ø§Ù„Ùƒ (Ø£Ø±ÙŠØ¯ Ø§Ù„Ù†Ø´Ø±)</button>
</div>
</div>

<div id="mainApp">
<header>
<button onclick="toggleMenu()" style="background:none; border:none; color:var(--p); font-size:24px;">â˜°</button>
<div class="search-bar"><input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†Ø²Ù„ØŒ Ø´Ù‚Ø©..." oninput="filterPosts()"></div>
<button onclick="toggleTheme()" style="background:none; border:none; color:var(--p);"><i class="fas fa-moon"></i></button>
</header>

<div class="categories">
<button class="cat-btn active" onclick="setCat('Ø§Ù„ÙƒÙ„')">Ø§Ù„ÙƒÙ„</button>
<button class="cat-btn" onclick="setCat('Ø´Ù‚Ù‚')">ğŸ™ï¸ Ø´Ù‚Ù‚</button>
<button class="cat-btn" onclick="setCat('ÙÙŠÙ„Ø§Øª')">ğŸ° ÙÙŠÙ„Ø§Øª</button>
<button class="cat-btn" onclick="setCat('Ù…Ù†Ø§Ø²Ù„')">ğŸ¡ Ù…Ù†Ø§Ø²Ù„</button>
<button class="cat-btn" style="background:var(--gold); color:black;" onclick="showPremiumPage()">âœ¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©</button>
</div>

<div id="cloudFeed"></div>
<button class="publish-btn-main" id="mainPublishBtn" onclick="openPublishModal(false)"></button>
</div>

<!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù†Ø´Ø± -->
<div id="publishModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:10000; align-items:center; justify-content:center; padding:20px;">
<div style="background:var(--card); width:100%; max-width:500px; padding:20px; border-radius:20px; max-height:90vh; overflow-y:auto;">
<h3 id="modalTitle" style="color:var(--p)">Ù†Ø´Ø± Ø¹Ù‚Ø§Ø± Ø¬Ø¯ÙŠØ¯</h3>
<select id="pType"><option value="Ø´Ù‚Ù‚">Ø´Ù‚Ø©</option><option value="ÙÙŠÙ„Ø§Øª">ÙÙŠÙ„Ø§</option><option value="Ù…Ù†Ø§Ø²Ù„">Ù…Ù†Ø²Ù„</option></select>
<input type="text" id="pTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù‚Ø§Ø± (Ù…Ø«Ø§Ù„: Ø´Ù‚Ø© ÙØ§Ø®Ø±Ø© Ù„Ù„Ø¨ÙŠØ¹)">
<input type="number" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±">
<textarea id="pDesc" rows="4" placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø± Ù‡Ù†Ø§..."></textarea>

<!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© -->
<div style="position:relative;">
<input type="text" id="pCityInput" placeholder="Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©..." readonly>
<div id="citySelector" style="display:none;">
<input type="text" id="citySearch" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¯ÙŠÙ†Ø©..." oninput="filterCities()">
<div id="citiesList"></div>
</div>
</div>

<input type="tel" id="pPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
<label class="btn" style="background:#333; cursor:pointer;"><input type="file" id="pFiles" multiple accept="image/*" onchange="handleFiles(this.files)" style="display:none;">ğŸ“¸ Ø§Ø®ØªØ± ØµÙˆØ± Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
<div id="preGrid" style="display:flex; gap:10px; margin:10px 0; overflow-x:auto;"></div>
<button class="btn" onclick="uploadToFirebase()">Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø¢Ù†</button>
<button class="btn" style="background:#111;" onclick="closePublishModal()">Ø¥Ù„ØºØ§Ø¡</button>
</div>
</div>

<div class="side-menu" id="sideMenu">
<h2 style="color:var(--p)">DIABLO HUB</h2>
<div style="background:linear-gradient(45deg, #1a1a1a, #000); border:1px solid var(--gold); padding:15px; border-radius:12px; text-align:center;">
<h4 style="color:var(--gold); margin:0;">ğŸš€ ØªÙ…ÙŠØ² Ø¨Ù€ 1$ ÙÙ‚Ø·!</h4>
<p style="font-size:11px; margin:5px 0;">Ø§Ø¬Ø¹Ù„ Ø¥Ø¹Ù„Ø§Ù†Ùƒ ÙÙŠ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© ÙˆØ´Ø§Ù‡Ø¯Ù‡ Ø§Ù„Ø¬Ù…ÙŠØ¹</p>
<a href="https://wa.me/212695067840" target="_blank" style="background:#25d366; color:white; padding:8px; border-radius:5px; text-decoration:none; display:inline-block; font-size:12px; font-weight:bold;"><i class="fab fa-whatsapp"></i> ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙŠ Ù„Ù„ØªÙ…ÙŠØ²</a>
</div>
<hr style="border:0; border-top:1px solid #333; margin:20px 0;">
<button class="btn" onclick="location.reload()">ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
<button class="btn" onclick="showPrivacy()">Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø®ØµÙˆØµÙŠØ©</button>
<button class="btn" onclick="showSupport()">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</button>
</div>

<div class="overlay" id="mainOverlay" onclick="toggleMenu()"></div>

<div id="botIcon" style="position:fixed; bottom:20px; left:20px; width:60px; height:60px; background:var(--p); border-radius:50%; display:flex; align-items:center; justify-content:center; z-index:9000; cursor:pointer; font-size:24px; box-shadow:0 0 15px var(--p);" onclick="toggleChat()">ğŸ¤–</div>
<div id="bot-chat-window">
<div style="background:var(--p); padding:10px; color:white; display:flex; justify-content:space-between;"><span>Ø¯ÙŠØ§Ø¨Ù„Ùˆ Ø¨ÙˆØª</span><span onclick="toggleChat()">âœ•</span></div>
<div class="chat-area" id="chatArea"></div>
<div style="display:flex; padding:10px; border-top:1px solid var(--border);">
<input type="text" id="bot-input" style="flex:1; border:none; background:none; color:var(--t);" placeholder="Ø§Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø´ÙŠØ¡...">
<button onclick="sendBotMsg()" style="background:none; border:none; color:var(--p);"><i class="fas fa-paper-plane"></i></button>
</div>
</div>

<div id="premiumPage">
<div class="content">
<h3 style="color:var(--gold)">Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø© âœ¨</h3>
<p>ÙŠÙ…ÙƒÙ†Ùƒ Ø¬Ø¹Ù„ Ù…Ù†Ø´ÙˆØ±Ùƒ Ù…Ù…ÙŠØ²Ø§Ù‹ Ù…Ù‚Ø§Ø¨Ù„ 1$â€“2$ØŒ Ù„ÙŠØ¸Ù‡Ø± Ø¨Ù„ÙˆÙ† Ø®Ø§Øµ ÙˆÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù†ØªØ´Ø§Ø± Ø³Ø±ÙŠØ¹.</p>
<button class="btn" onclick="closePremiumPage()">Ø¥ØºÙ„Ø§Ù‚</button>
</div>
</div>

<div id="privacyPage" class="content" style="display:none; background:var(--card); padding:20px; border-radius:15px;">
<h3>Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø®ØµÙˆØµÙŠØ©</h3>
<p>Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø®ØµÙˆØµÙŠØ© Ù‡Ù†Ø§...</p>
<button class="btn" onclick="closePrivacy()">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<div id="supportPage" class="content" style="display:none; background:var(--card); padding:20px; border-radius:15px;">
<h3>Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</h3>
<p>Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ...</p>
<button class="btn" onclick="closeSupport()">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<script>
// Firebase
const firebaseConfig = { apiKey: "AIzaSyCGWNteBBsejx6UISfvnTY1YmnQeom7vNg", authDomain: "daiblosmart.firebaseapp.com", projectId: "daiblosmart", storageBucket: "daiblosmart.firebasestorage.app" };
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

let currentUser=null,tempImgs=[],isPremiumPost=false,currentCat='Ø§Ù„ÙƒÙ„';
auth.onAuthStateChanged(u=>{ if(u) currentUser=u; });

// Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ù…ØºØ±Ø¨ÙŠØ©
const moroccoCities=["Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡","Ù…Ø±Ø§ÙƒØ´","ÙØ§Ø³","Ø·Ù†Ø¬Ø©","Ø£ÙƒØ§Ø¯ÙŠØ±","ÙˆØ¬Ø¯Ø©","Ù…ÙƒÙ†Ø§Ø³","ØªØ·ÙˆØ§Ù†","Ø³Ù„Ø§","Ø§Ù„Ù‚Ù†ÙŠØ·Ø±Ø©","Ø§Ù„Ø±Ø¨Ø§Ø·","Ø¨Ø±Ø´ÙŠØ¯","Ø®Ø±ÙŠØ¨ÙƒØ©","Ø§Ù„Ø¹ÙŠÙˆÙ†","Ø·Ø§Ù†Ø·Ø§Ù†","ÙƒÙ„Ù…ÙŠÙ…","ØªØ§Ø±ÙˆØ¯Ø§Ù†Øª","Ø§Ù„Ù†Ø§Ø¸ÙˆØ±","Ø§Ù„Ø­Ø³ÙŠÙ…Ø©","Ø§Ù„Ø¹Ø±Ø§Ø¦Ø´","Ø¨Ù†ÙŠ Ù…Ù„Ø§Ù„","Ø³Ø·Ø§Øª","Ø§Ù„ÙŠÙˆØ³ÙÙŠØ©","Ø§Ù„ØµÙˆÙŠØ±Ø©","Ø§Ù„ØµØ®ÙŠØ±Ø§Øª","Ø§Ù„Ø³ÙˆÙŠØ³","Ø§Ù„ØµÙˆÙŠØ±Ø©","ØªØ§Ø²Ø©","Ø£Ø²ÙŠÙ„Ø§Ù„","Ø§Ù„Ø³Ù…Ø§Ø±Ø©","Ø§Ù„Ø¯Ø§Ø®Ù„Ø©","Ø§Ù„Ø¹ÙŠÙˆÙ†","Ø§Ù„Ø³Ù…Ø§Ø±Ø©"];

// Ø§Ù„ÙˆØ¸Ø§Ø¦Ù
function setRole(role){ document.getElementById('startScreen').style.display='none'; document.getElementById('mainApp').style.display='block'; if(role==='seller') document.getElementById('mainPublishBtn').style.display='flex'; loadCloudData(); }
function loadCloudData(){
    db.collection("diablo_posts").orderBy("isPremium","desc").orderBy("time","desc").onSnapshot(snap=>{
        const feed=document.getElementById('cloudFeed'); feed.innerHTML="";
        snap.forEach(doc=>{
            const p=doc.data(); 
            if(currentCat!=='Ø§Ù„ÙƒÙ„' && p.type!==currentCat) return;
            let delBtn=(currentUser && currentUser.uid===p.userId)?`<button class='btn' style='background:red;margin-top:5px;' onclick='deletePost("${doc.id}")'>Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±</button>`:'';
            feed.innerHTML+=`
            <div class='post-card ${p.isPremium?'premium':''}' data-title='${p.title.toLowerCase()}' data-city='${p.city.toLowerCase()}' data-price='${p.price}'>
            ${p.isPremium?'<span style="color:gold; font-size:10px; font-weight:bold;">âœ¨ Ø¥Ø¹Ù„Ø§Ù† Ù…Ù…ÙŠØ²</span>':''}
            <span class='price-tag'>${p.price}$</span>
            <div style='display:flex; overflow-x:auto; gap:10px;'>${p.imgs.map(i=>`<img src='${i}' style='height:150px;border-radius:10px;'>`).join('')}</div>
            <h3>${p.title}</h3>
            <p style='font-size:13px;opacity:0.8;'>${p.desc}</p>
            <p style='font-size:13px;opacity:0.8;'>Ù…Ø¯ÙŠÙ†Ø©: ${p.city}</p>
            <a href='tel:${p.phone}' class='btn'>ğŸ“ Ø§ØªØµÙ„ Ø¨Ø§Ù„Ù…Ø§Ù„Ùƒ</a>
            ${delBtn}</div>`;
        });
    });
}
function deletePost(id){ db.collection("diablo_posts").doc(id).delete(); }
function filterPosts(){ 
    const q=document.getElementById('searchInput').value.toLowerCase();
    document.querySelectorAll('.post-card').forEach(c=>{ 
        c.style.display=(c.getAttribute('data-title').includes(q) || c.getAttribute('data-city').includes(q))?'block':'none'; 
    });
}

// Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø³ÙƒØ±Ø¨ØªØ§Øª: Ø§Ù„Ù…Ù„ÙØ§ØªØŒ Ù†Ø´Ø±ØŒ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¯Ù†ØŒ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø¯Ù†ØŒ Ø§Ù„Ø¨ÙˆØª...
// Ø¨Ø³Ø¨Ø¨ Ø·ÙˆÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ÙƒØ§Ù…Ù„ Ø³Ø£Ø±Ø³Ù„ Ù„Ùƒ Ø¨Ù‚ÙŠØ© Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø¨Ø¹Ø¯ Ù‚Ù„ÙŠÙ„ Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„ ÙƒÙ„ Ø´ÙŠØ¡ Ø¨Ø´ÙƒÙ„ Ø³Ù„ÙŠÙ…
</script>

</body>
</html>
``
