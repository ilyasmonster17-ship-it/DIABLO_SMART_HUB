<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Diablo Hub | Morocco</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <style>
        :root{--p:#ff4500;--bg:#050505;--card:#111;--t:#fff;--border:#222;--gold:#ffd700;}
        .light-mode{--bg:#f5f5f5;--card:#fff;--t:#222;--border:#ddd;}
        body{background:var(--bg);color:var(--t);font-family:'Cairo',sans-serif;margin:0;padding-bottom:100px;overflow-x:hidden;}
        #startScreen{display:flex;position:fixed;inset:0;background:var(--bg);z-index:9999;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:20px;}
        #mainApp{display:none;}
        header{padding:15px 5%;display:flex;justify-content:space-between;align-items:center;background:var(--card);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:1000;}
        .side-menu{position:fixed;top:0;right:-100%;width:280px;height:100%;background:var(--card);z-index:9500;transition:0.4s;padding:20px;box-sizing:border-box;border-left:1px solid var(--border);overflow-y:auto;}
        .side-menu.active{right:0;}
        .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:none;z-index:9400;}
        
        .search-container{padding:10px 5%; background:var(--bg);}
        .search-box{width:100%; padding:12px 15px; border-radius:10px; border:1px solid var(--border); background:var(--card); color:var(--t); font-family:'Cairo'; outline:none; transition:0.3s;}
        .search-box:focus{border-color:var(--p); box-shadow: 0 0 5px rgba(255,69,0,0.3);}

        .categories{display:flex;overflow-x:auto;gap:10px;padding:10px 5%;white-space:nowrap;}
        .cat-btn{background:var(--card);border:1px solid var(--border);color:var(--t);padding:8px 15px;border-radius:20px;cursor:pointer;}
        .cat-btn.active{background:var(--p);color:white;border-color:var(--p);}
        .post-card{background:var(--card);border:1px solid var(--border);border-radius:15px;margin:15px 5%;padding:15px;position:relative;}
        .price-tag{position:absolute;top:10px;left:10px;background:#25d366;color:white;padding:3px 12px;border-radius:20px;font-weight:bold;}
        .ref-tag{font-size:11px; color:var(--p); opacity:0.7; margin-top:5px; display:block;}
        
        .btn{background:var(--p);color:white;border:none;padding:12px;border-radius:8px;cursor:pointer;font-weight:bold;width:100%;margin-top:10px;text-align:center;text-decoration:none;display:block;}
        #publishModal, #premiumPage, #policyModal, #investModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:10001;align-items:center;justify-content:center;padding:20px;}
        .modal-content{background:var(--card);padding:20px;border-radius:15px;max-width:500px;width:100%;max-height:90vh;overflow-y:auto;}
        input,textarea,select{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:1px solid var(--border);background:var(--bg);color:var(--t);box-sizing:border-box;}
        .loading-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.9);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:20000;color:white;}
        .publish-btn-main{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);width:60px;height:60px;background:var(--p);border-radius:50%;display:none;align-items:center;justify-content:center;z-index:9000;border:none;color:white;font-size:30px;box-shadow:0 4px 15px rgba(255,69,0,0.4);}
        .whatsapp-btn{background:#25d366; color:white; border-radius:50%; width:60px; height:60px; display:flex; align-items:center; justify-content:center; font-size:30px; margin:20px auto; text-decoration:none;}
        
        .file-upload-label{display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px; border:2px dashed var(--border); border-radius:10px; cursor:pointer; color:var(--p); margin:10px 0;}
        .file-upload-label i{font-size:30px; margin-bottom:5px;}
        .invest-btn{background:#007bff; font-size:12px; padding:8px;}
        .premium-feature{text-align:right; background:rgba(255,215,0,0.1); padding:10px; border-radius:10px; margin:10px 0; border-right:3px solid var(--gold);}
        .tag-info{display:inline-block; background:rgba(255,69,0,0.1); color:var(--p); padding:2px 8px; border-radius:5px; font-size:12px; margin-top:5px; margin-left:5px;}
        .roi-card{background:rgba(0,123,255,0.1); border:1px solid #007bff; padding:15px; border-radius:10px; margin:15px 0;}
    </style>
</head>
<body>

<div id="loading" class="loading-overlay"><i class="fas fa-spinner fa-spin" style="font-size:40px;color:var(--p)"></i><p id="loadText">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</p></div>

<div id="startScreen">
    <h1 style="color:var(--p);font-size:40px;">DIABLO HUB</h1>
    <p>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø£Ù‚ÙˆÙ‰ Ù…Ù†ØµØ© Ø¹Ù‚Ø§Ø±ÙŠØ© ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨</p>
    <div style="width:100%;max-width:300px;margin-top:20px;">
        <button class="btn" onclick="setRole('investor')">ØªØµÙØ­ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</button>
        <button class="btn" style="background:#222;border:1px solid var(--p);" onclick="setRole('seller')">Ø£Ø±ÙŠØ¯ Ø§Ù„Ù†Ø´Ø± (Ù…Ø§Ù„Ùƒ)</button>
    </div>
</div>

<div id="mainApp">
    <header>
        <button onclick="toggleMenu()" style="background:none;border:none;color:var(--p);font-size:24px;">â˜°</button>
        <strong style="color:var(--p)">DIABLO HUB</strong>
        <button onclick="toggleTheme()" style="background:none;border:none;color:var(--p);font-size:20px;"><i class="fas fa-moon" id="themeIcon"></i></button>
    </header>

    <div class="search-container">
        <input type="text" id="searchInput" class="search-box" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù†: Ù…Ø³Ø¨Ø­ØŒ Ù…Ø±Ø§ÙƒØ´ØŒ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹..." oninput="listenToPosts()">
    </div>

    <div class="categories">
        <button class="cat-btn active" onclick="setCat('Ø§Ù„ÙƒÙ„', this)">Ø§Ù„ÙƒÙ„</button>
        <button class="cat-btn" onclick="setCat('Ø´Ù‚Ù‚', this)">ğŸ™ï¸ Ø´Ù‚Ù‚</button>
        <button class="cat-btn" onclick="setCat('ÙÙŠÙ„Ø§Øª', this)">ğŸ° ÙÙŠÙ„Ø§Øª</button>
        <button class="cat-btn" onclick="setCat('Ù…Ù†Ø§Ø²Ù„', this)">ğŸ¡ Ù…Ù†Ø§Ø²Ù„</button>
        <button class="cat-btn" style="background:var(--gold);color:black;font-weight:bold;" onclick="showPremium()">âœ¨ ØªÙ…ÙŠØ² Ø§Ù„Ø¢Ù†</button>
    </div>

    <div id="feed"></div>
    <button class="publish-btn-main" id="mainPubBtn" onclick="document.getElementById('publishModal').style.display='flex'">+</button>
</div>

<div id="investModal">
    <div class="modal-content">
        <h3 style="color:#007bff; text-align:center;"><i class="fas fa-chart-line"></i> ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠ</h3>
        <div id="investDetails"></div>
        <p style="font-size:10px; color:gray; text-align:center; margin-top:10px;">
            âš ï¸ Ø¥Ø®Ù„Ø§Ø¡ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©: Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ ØªÙ‚Ø¯ÙŠØ±Ø§Øª Ù…Ø¨Ù†ÙŠØ© Ø¹Ù„Ù‰ Ù…ØªÙˆØ³Ø· Ø³ÙˆÙ‚ Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ù…ØºØ±Ø¨ÙŠ ÙˆÙ„Ø§ ØªØ¹ØªØ¨Ø± Ø¶Ù…Ø§Ù†Ø§Ù‹ Ù„Ù„Ø±Ø¨Ø­ Ø§Ù„ÙØ¹Ù„ÙŠ.
        </p>
        <button class="btn" style="background:#007bff;" onclick="document.getElementById('investModal').style.display='none'">ÙÙ‡Ù…Øª Ø°Ù„Ùƒ</button>
    </div>
</div>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>
<div class="side-menu" id="sideMenu">
    <h2 style="color:var(--p)">DIABLO HUB</h2>
    <hr style="border:0;border-top:1px solid var(--border);margin:10px 0;">
    <button class="btn" onclick="location.reload()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button class="btn" onclick="showPremium()">ğŸ’ Ø¥Ø¹Ù„Ø§Ù† Ù…Ù…ÙŠØ²</button>
    <button class="btn" onclick="toggleTheme()">ğŸŒ“ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¸Ù‡Ø±</button>
    <hr style="border:0;border-top:1px solid var(--border);margin:20px 0;">
    <button class="btn" style="background:none; color:var(--t); font-size:14px;" onclick="showPolicy('terms')">ğŸ“œ Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</button>
    <button class="btn" style="background:none; color:var(--t); font-size:14px;" onclick="showPolicy('privacy')">ğŸ”’ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</button>
    <button class="btn" style="background:none; color:var(--t); font-size:14px;" onclick="showPolicy('disclaimer')">âš ï¸ Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©</button>
</div>

<div id="policyModal">
    <div class="modal-content">
        <h3 id="policyTitle" style="color:var(--p)"></h3>
        <div id="policyBody" style="font-size:14px; line-height:1.8; text-align: justify;"></div>
        <button class="btn" onclick="document.getElementById('policyModal').style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<div id="publishModal">
    <div class="modal-content">
        <h3 style="color:var(--p)">Ù†Ø´Ø± Ø¹Ù‚Ø§Ø± Ø¬Ø¯ÙŠØ¯</h3>
        <select id="pType"><option value="Ø´Ù‚Ù‚">Ø´Ù‚Ø©</option><option value="ÙÙŠÙ„Ø§Øª">ÙÙŠÙ„Ø§</option><option value="Ù…Ù†Ø§Ø²Ù„">Ù…Ù†Ø²Ù„</option></select>
        <input type="text" id="pTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù‚Ø§Ø± (Ù…Ø«Ø§Ù„: Ø´Ù‚Ø© ÙÙŠ Ø·Ù†Ø¬Ø©)">
        <input type="number" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¯Ø±Ù‡Ù… (DH)">
        <textarea id="pDesc" rows="3" placeholder="Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©..."></textarea>
        <input type="text" id="pExtras" placeholder="Ù…Ù…ÙŠØ²Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ù…Ø³Ø¨Ø­ØŒ ÙƒØ±Ø§Ø¬ØŒ Ø¬Ù†Ø¨ Ø§Ù„Ø¨Ø­Ø±...)">
        <input type="tel" id="pPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù„ØªÙˆØ§ØµÙ„">
        
        <label class="file-upload-label">
            <i class="fas fa-images"></i>
            <span>Ø¥Ø¶Ø§ÙØ© ØµÙˆØ± Ø§Ù„Ø¹Ù‚Ø§Ø±</span>
            <input type="file" id="pFiles" multiple accept="image/*" onchange="handleFiles(this.files)" style="display:none;">
        </label>
        
        <div id="preGrid" style="display:flex;gap:10px;margin:10px 0;overflow-x:auto;"></div>
        <button class="btn" onclick="uploadPost()">Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø¢Ù†</button>
        <button class="btn" style="background:#111;" onclick="document.getElementById('publishModal').style.display='none'">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<div id="premiumPage">
    <div class="modal-content" style="text-align:center;">
        <h2 style="color:var(--gold)">ÙƒÙ† Ù…ØªÙ…ÙŠØ²Ø§Ù‹ âœ¨</h2>
        <p>Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ¨Ø¹ Ø¹Ù‚Ø§Ø±Ùƒ Ø¨Ø³Ø±Ø¹Ø© Ø§Ù„Ø¨Ø±Ù‚</p>
        <div class="premium-feature">âœ… <b>Ø§Ù†ØªØ´Ø§Ø± Ø£Ø³Ø±Ø¹:</b> ÙŠØ¸Ù‡Ø± Ø¥Ø¹Ù„Ø§Ù†Ùƒ Ù„Ø¢Ù„Ø§Ù Ø§Ù„Ù…Ù‡ØªÙ…ÙŠÙ† Ø£ÙˆÙ„Ø§Ù‹.</div>
        <div class="premium-feature">âœ… <b>Ù„ÙˆÙ† Ù…Ù…ÙŠØ²:</b> ØªØµÙ…ÙŠÙ… Ø¬Ø°Ø§Ø¨ ÙŠØ¬Ø¹Ù„ Ø¥Ø¹Ù„Ø§Ù†Ùƒ ÙŠØ¨Ø±Ø² Ø¹Ù† Ø§Ù„Ø¨Ù‚ÙŠØ©.</div>
        <div class="premium-feature">âœ… <b>ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ù†Ø´ÙˆØ±:</b> Ø¥Ø¹Ù„Ø§Ù†Ùƒ Ø³ÙŠØ¨Ù‚Ù‰ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹.</div>
        <p style="font-weight:bold; color:var(--p); font-size:20px;">ÙÙ‚Ø· Ø¨Ù€ 1$</p>
        <p>Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ…ÙŠØ²ØŒ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ÙÙˆØ±Ø§Ù‹:</p>
        <a href="https://wa.me/212695067840" target="_blank" class="whatsapp-btn"><i class="fab fa-whatsapp"></i></a>
        <button class="btn" onclick="document.getElementById('premiumPage').style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCGWNteBBsejx6UISfvnTY1YmnQeom7vNg",
        authDomain: "daiblosmart.firebaseapp.com",
        projectId: "daiblosmart",
        storageBucket: "daiblosmart.appspot.com"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    if(!localStorage.getItem('myDiabloID')){
        localStorage.setItem('myDiabloID', 'user_' + Math.random().toString(36).substr(2, 9));
    }
    const myID = localStorage.getItem('myDiabloID');
    let isAdmin = false, userRole = 'investor'; 
    let tempImgs = [], currentCat = 'Ø§Ù„ÙƒÙ„';

    function setRole(role) {
        userRole = role; 
        document.getElementById('startScreen').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        if(role === 'seller') document.getElementById('mainPubBtn').style.display = 'flex';
        listenToPosts();
    }

    function toggleMenu() {
        document.getElementById('sideMenu').classList.toggle('active');
        document.getElementById('overlay').style.display = document.getElementById('sideMenu').classList.contains('active') ? 'block' : 'none';
    }

    function toggleTheme() {
        document.body.classList.toggle('light-mode');
        document.getElementById('themeIcon').className = document.body.classList.contains('light-mode') ? 'fas fa-sun' : 'fas fa-moon';
    }

    // ÙˆØ¸ÙŠÙØ© Ù„Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
    function showSystemMsg(title, msg) {
        document.getElementById('policyTitle').innerText = title;
        document.getElementById('policyBody').innerHTML = `<div style="text-align:center; padding:20px;">${msg}</div>`;
        document.getElementById('policyModal').style.display = 'flex';
    }

    async function handleFiles(files) {
        for(let f of files) {
            const reader = new FileReader();
            reader.readAsDataURL(f);
            reader.onload = (e) => {
                const img = new Image();
                img.src = e.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 500; canvas.height = (img.height / img.width) * 500;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    const compressed = canvas.toDataURL('image/jpeg', 0.6);
                    tempImgs.push(compressed);
                    document.getElementById('preGrid').innerHTML += `<img src="${compressed}" style="width:60px;height:60px;border-radius:5px;object-fit:cover;">`;
                };
            };
        }
    }

    function showROI(price, type) {
        let annualRental = price * 0.08; 
        if(type === 'ÙÙŠÙ„Ø§Øª') annualRental = price * 0.10;
        let roi = (annualRental / price) * 100;
        
        const details = document.getElementById('investDetails');
        details.innerHTML = `
            <div class="roi-card">
                <p>ğŸ’° <b>Ø³Ø¹Ø± Ø§Ù„Ø¹Ù‚Ø§Ø±:</b> ${price} DH</p>
                <p>ğŸ“ˆ <b>Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</b> ${annualRental.toFixed(0)} DH</p>
                <p>â­ <b>Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­ (ROI):</b> ${roi.toFixed(1)}%</p>
            </div>
            <p style="text-align:right; font-size:13px;">Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù‚Ø§Ø± Ù…Ù† Ù†ÙˆØ¹ <b>${type}</b>ØŒ ÙˆØªØ¹ØªØ¨Ø± Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø¨Ø© Ù…Ù…ØªØ§Ø²Ø© Ù„Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ø·ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¯Ù‰ ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©.</p>
        `;
        document.getElementById('investModal').style.display = 'flex';
    }

    function uploadPost() {
        const t = document.getElementById('pTitle').value, p = document.getElementById('pPrice').value;
        const extras = document.getElementById('pExtras').value;
        if(!t || !p || tempImgs.length === 0) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØµÙˆØ±");
        document.getElementById('loadText').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...";
        document.getElementById('loading').style.display = 'flex';
        const refId = "D" + Math.floor(1000 + Math.random() * 9000);
        db.collection("posts").add({
            title: t, price: p, desc: document.getElementById('pDesc').value,
            extras: extras, type: document.getElementById('pType').value, 
            phone: document.getElementById('pPhone').value, imgs: tempImgs, 
            userId: myID, time: Date.now(), ref: refId
        }).then(() => location.reload());
    }

    function listenToPosts() {
        const feed = document.getElementById('feed');
        const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
        
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ù…Ø­Ø¯Ø«
        if(searchTerm === '3505ilyas2008@') {
            isAdmin = true;
            document.getElementById('searchInput').value = "";
            showSystemMsg("Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©", "ØªÙ… ØªÙØ¹ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù† Ø¨Ù†Ø¬Ø§Ø­ âœ…<br>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª.");
            listenToPosts();
            return;
        }
        
        // Ù†Ø¸Ø§Ù… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ù…Ø­Ø¯Ø«
        if(searchTerm === 'Ø­Ø¯Ù 3505ilyas2008@') {
            isAdmin = false;
            document.getElementById('searchInput').value = "";
            showSystemMsg("Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©", "ØªÙ… Ø¥ÙŠÙ‚Ø§Ù ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù† âŒ<br>Ø¹ÙØ¯Øª Ø§Ù„Ø¢Ù† Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ.");
            listenToPosts();
            return;
        }

        db.collection("posts").orderBy("time", "desc").onSnapshot(snap => {
            feed.innerHTML = "";
            snap.forEach(doc => {
                const data = doc.data();
                const combinedText = `${data.title} ${data.desc} ${data.extras || ''} ${data.ref || ''} ${data.type}`.toLowerCase();
                const isMatch = combinedText.includes(searchTerm);
                if(currentCat !== 'Ø§Ù„ÙƒÙ„' && data.type !== currentCat) return;
                if(searchTerm && !isMatch) return;

                let del = (data.userId === myID || isAdmin) ? `<button onclick="deletePost('${doc.id}')" style="background:red;border:none;color:white;padding:5px;border-radius:5px;cursor:pointer; font-size:12px; margin-top:10px; width:100%;">Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±</button>` : "";
                let tagsHtml = data.extras ? data.extras.split(/[,ØŒ]+/).map(ex => `<span class="tag-info">${ex.trim()}</span>`).join('') : '';
                
                let investBtn = (userRole === 'investor') ? `<button class="btn invest-btn" onclick="showROI(${data.price}, '${data.type}')" style="flex:1; margin:0;">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø¨Ø­ ğŸ“ˆ</button>` : "";

                feed.innerHTML += `<div class="post-card">
                    <span class="price-tag">${data.price} DH</span>
                    <div style="display:flex;overflow-x:auto;gap:10px;margin-bottom:10px;">${data.imgs.map(img => `<img src="${img}" style="height:150px;border-radius:10px;min-width:200px;object-fit:cover;">`).join('')}</div>
                    <h3 style="margin-bottom:5px;">${data.title}</h3>
                    <p style="font-size:14px;opacity:0.8;margin:5px 0;">${data.desc}</p>
                    <div style="margin-bottom:10px;">${tagsHtml}</div>
                    <span class="ref-tag">Ù…Ø±Ø¬Ø¹: ${data.ref || '#N/A'}</span>
                    <div style="display:flex;gap:10px; align-items:center; margin-top:10px;">
                        <a href="tel:${data.phone}" class="btn" style="flex:1; margin:0;">Ø§ØªØµØ§Ù„</a>
                        ${investBtn}
                    </div>
                    ${del}
                </div>`;
            });
        });
    }

    function deletePost(id) { if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†Ø´ÙˆØ±ØŸ")) db.collection("posts").doc(id).delete(); }
    function setCat(cat, btn) {
        currentCat = cat;
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        listenToPosts();
    }
    function showPremium() { document.getElementById('premiumPage').style.display = 'flex'; }
    function showPolicy(type) {
        const title = document.getElementById('policyTitle'), body = document.getElementById('policyBody');
        if(type === 'terms') { 
            title.innerText = "Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…"; 
            body.innerHTML = "ÙŠØ±Ø¬Ù‰ Ù‚Ø±Ø§Ø¡Ø© Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨Ø¹Ù†Ø§ÙŠØ©... (Ù†Øµ Ø§Ù„Ø´Ø±ÙˆØ·)"; 
        }
        else if(type === 'privacy') { 
            title.innerText = "Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©"; 
            body.innerHTML = "Ù†Ø­Ù† Ù†Ù‡ØªÙ… Ø¨Ø®ØµÙˆØµÙŠØªÙƒ... (Ù†Øµ Ø§Ù„Ø®ØµÙˆØµÙŠØ©)"; 
        }
        else { 
            title.innerText = "Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©"; 
            body.innerHTML = "ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù… Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†... (Ù†Øµ Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©)"; 
        }
        document.getElementById('policyModal').style.display = 'flex';
        toggleMenu();
    }
</script>
</body>
    </html>
    
